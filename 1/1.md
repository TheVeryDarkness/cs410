# 计算机网络体系结构第一次作业

作业要求：

> 请以一段时间内的真实指数基金行情数据，
>
> 1）验证定期等额平均成本投资法。例如：投资周期可以是日、周、月、季度、年，投资粒度 5000 元人民币，手续费参照代码 1“获取行情数据程序”中的 buy, sell 注释部分。
>
> 2）给出较优的投资周期、ETF 基金标的等参数，及理由。
>
> 3）验证附录 A 中的 14.1 资产配置原则之一：重新调整投资组合内资产类别的权重可以降低风险，在某些情况下，还可以提高投资收益。
>
> 注：行情数据可以通过 AKSahre 接口获得，https://akshare.akfamily.xyz

## 实验设置

**评价指标**：收益率、最大回撤率、平均回撤率。

买卖的最小单位是一手，即 100 份。

考虑印花税、过户费、佣金等交易费用。

### 数据

进行投资的时间段为 2017 年 9 月 1 日到 2024 年 3 月 14 日。为了分析的需要，可能会使用在该时间段之前的部分数据。

在示例代码上新增了几个标的。（斜体部分为新增）

股票基金：

- 房地产 ETF
- 中概互联网 ETF
- 沪深 300 ETF
- 上证 50 ETF
- 中证 500 ETF
- 创业板 ETF
- 中小 100ETF
- 医药 ETF
- 证券 ETF
- 环保 ETF
- 恒生 ETF
- H 股 ETF
- 标普 500 ETF
- 纳指 ETF
- 军工 ETF
- _银行 ETF_
- _传媒 ETF_

债券基金：

- _国债 ETF_
- _十年国债 ETF_

|    日期    | 房地产 ETF | 中概互联网 ETF | 沪深 300ETF | 上证 50ETF | 中证 500ETF | 创业板 ETF | 中小 100ETF | 医药 ETF | 证券 ETF | 环保 ETF | 恒生 ETF | H 股 ETF | 标普 500ETF | 纳指 ETF | 军工 ETF | 银行 ETF | 传媒 ETF | 国债 ETF | 十年国债 ETF |
| :--------: | :--------: | :------------: | :---------: | :--------: | :---------: | :--------: | :---------: | :------: | :------: | :------: | :------: | :------: | :---------: | :------: | :------: | :------: | :------: | :------: | :----------: |
| 2017-09-01 |    NaN     |    1.440123    |  1.167898   |  1.212974  |  1.032103   |  0.852207  |  1.071719   | 1.136997 | 1.088123 | 1.006944 | 1.212072 | 1.180312 |  1.073519   | 1.220649 | 0.887463 | 1.005005 |   NaN    | 0.976216 |   1.003810   |
| 2024-03-14 |  0.521053  |    0.945752    |  1.199148   |  1.219617  |  0.940610   |  0.879079  |  0.903310   | 1.198142 | 0.853448 | 0.957341 | 0.881729 | 0.769006 |  2.546752   | 3.905605 | 0.881540 | 1.143143 | 0.746254 | 1.191415 |   1.270799   |

### 交易周期

选取的交易周期：

- 1 天，对应一日。
- 3 天，对应半周。
- 7 天，对应一周。
- 15 天，对应半月。
- 30 天，对应月。
- 90 天，对应季度。
- 180 天，对应半年。
- 365 天，对应年。
- 3000 天，对应一次性买入。

_注：由于 `datetime` 库的 `timedelta` 只支持日或者周等确定长度的时间段，此处全部以日数为单位。_

### 资金投入

按照每天 1000 元的粒度进行投入。

## 实验原理和实现

- 定期等额平均成本投资法：每个周期投入相同的资金，之前周期剩余的资金将滚动到下一周期。

  该对照试验中，每次选择上述标的中的一个，进行定期等额平均成本投资法的投资测试。

- 静态投资组合：在按照定期等额平均成本投资法以不同周期投入资金的同时，每个交易日检查投资组合比例，如果超出范围则进行调整。

  在对照试验中，每次选择上述股基中的一个和十年国债 ETF 组成组合，进行定期等额平均成本投资法和静态投资组合的投资测试。

  实验中投入资金的周期仍然按照上述比例，但每个交易日都会检查投资组合，如果超出范围则进行调整。

  在实验中，股基和债基的预期比例为 7:3，最高比例和最低比例分别为 8:2 和 6:4，当比例超出范围后将通过出售部分基金，使比例接近 7:3，反之则通过当期投入资金的配比使比例趋向于 7:3。

具体实现见 Jupyter Notebook。

## 实验结果与分析

此处从以下三个指标出发进行了比较：

- 收益率：投资收益与投入资金的比值。
- 最大回撤：投资过程中的最大损失率。
- 平均回撤：投资过程中的平均损失率。

### 对定期等额平均成本投资法在单个 ETF 上的验证

以房地产 ETF 为例：

| 投资周期 |  1 天  |  3 天  |  7 天  | 15 天  | 30 天  | 90 天  | 180 天 | 365 天 | 3000 天 |
| :------: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :-----: |
|  收益率  | -0.579 | -0.363 | -0.362 | -0.362 | -0.364 | -0.367 | -0.368 | -0.374 | -0.479  |
| 最大回撤 | 0.440  | 0.438  | 0.437  | 0.438  | 0.437  | 0.448  | 0.462  | 0.443  |  0.536  |
| 平均回撤 | 0.079  | 0.075  | 0.074  | 0.075  | 0.079  | 0.082  | 0.094  | 0.074  |  0.162  |

可见除了投资周期为 1 天的情况下损失会增大外，定期等额平均成本投资法在房地产 ETF 上起到了降低风险的作用，减少了损失，降低了回撤。

下列各图中可以更清晰地看到定期等额平均成本投资法在不同的 ETF 上起到的降低收益率、降低回撤率的作用：

- 收益率：

  ![收益率](gain.png)

  可以看到对于房地产 ETF、中概互联网、中证 500ETF、证券 ETF、恒生 ETF、H 股 ETF、传媒 ETF，定期等额平均成本投资法都起到了减少损失的作用。

  但同时需要注意的是，对于标普 500ETF、纳指 ETF，定期等额平均成本投资法降低了收益率，而对于沪深 300ETF、上证 50ETF、创业板 ETF、医药 ETF、军工 ETF，定期等额平均成本投资法甚至反而造成了少量损失。

    <!--中小 100ETF、环保 ETF、银行 ETF、国债 ETF、十年国债 ETF-->

- 最大回撤率：

  ![最大回撤率](max_drawback.png)

  定期等额平均成本投资法在过半 ETF 上都起到了降低最大回撤率的作用，但在医药 ETF 上导致回撤率上升。

- 平均回撤率：

  ![平均回撤率](average_drawback.png)

  定期等额平均成本投资法在大部分 ETF 上都起到了使平均回撤率趋于 0 的作用；有趣的是，它在医药 ETF、证券 ETF 等基金上促使平均回撤率由正变为负，即平均意义上未发生回撤。

### 对定期等额平均成本投资法和静态投资组合在一对 ETF 上的验证

仍以房地产 ETF 为例：

| 投资周期 |  1 天  |  3 天  |  7 天  | 15 天  | 30 天  | 90 天  | 180 天 | 365 天 | 3000 天 |
| :------: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :-----: |
|  收益率  | -0.493 | -0.234 | -0.216 | -0.215 | -0.232 | -0.242 | -0.215 | -0.242 | -0.288  |
| 最大回撤 | 0.289  | 0.287  | 0.278  | 0.284  | 0.283  | 0.306  | 0.294  | 0.297  |  0.344  |
| 平均回撤 | 0.038  | 0.036  | 0.033  | 0.035  | 0.036  | 0.039  | 0.047  | 0.034  |  0.082  |

与[之前](#对定期等额平均成本投资法在单个-etf-上的验证)相比：

| 投资周期 |  1 天  |  3 天  |  7 天  | 15 天  | 30 天  | 90 天  | 180 天 | 365 天 | 3000 天 |
| :------: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :-----: |
|  收益率  | -0.579 | -0.363 | -0.362 | -0.362 | -0.364 | -0.367 | -0.368 | -0.374 | -0.479  |
| 最大回撤 | 0.440  | 0.438  | 0.437  | 0.438  | 0.437  | 0.448  | 0.462  | 0.443  |  0.536  |
| 平均回撤 | 0.079  | 0.075  | 0.074  | 0.075  | 0.079  | 0.082  | 0.094  | 0.074  |  0.162  |

可以看到收益率得到上升，最大回撤和平均回撤都有所下降。

其他 ETF 的结果也类似：

- ![收益率](gain-.png)
- ![最大回撤率](max-drawdown-.png)
- ![平均回撤率](average-drawdown-.png)

且此处的投资结果略好于两种基金投资结果的加权平均。

## 总结和自评分

- 选择适当的投资周期和投资粒度，可以起到降低风险的作用，减少损失，降低回撤。
- 选择适当的静态投资组合，可以起到提高收益、降低回撤的作用。
- 在实际投资中，可以根据不同的 ETF 选择不同的投资策略，以达到最优的投资效果。
- 采用定期等额平均成本投资法和静态投资组合时，可以适当延长投资周期，以减少不必要的交易费用。

- Present：2 / 4 分，迟交。
- 源程序代码：3.5 / 4 分。有基本的注释，但代码不够清晰、简洁。
- 作业报告：3.5 / 4 分。几部分完整，但实验结果与分析部分的图表不够清晰，没有对两种策略的结果进行直接的比对。

## 感谢和收获

感谢老师的指导，让我对投资的基本原则和方法有了更深入的了解。

同学们的报告也非常生动、深刻。

在进行本次作业中，我时常想到自己仍然尚未用于投资的资金，希望在未来能够借助本次课程中学到的知识，更好地进行投资。
