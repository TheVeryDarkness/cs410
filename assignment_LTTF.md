# 复现《海龟交易法则》长期趋势跟踪系统

Replicating the Long-Term Trend Following System of the 'Turtle Trading Rules'



Updated 2100 GMT+8 Apr 22, 2024

2023 spring, Complied by Hongfei Yan



**说明：**

需要独立完成，在canvas对应作业中，

1）提交10～30分钟的present（在canvas上，利用studio完成，录制时候，需要自己头像出现）（7分）

2）present提交之后，请把作业报告（7分）、源程序代码py、jupyter等（7分），上传到右侧的“作业评论”区。在报告中请自评当次作业分数（满分是21分）及理由。

作业报告包括：实验设置（目标、数据、参数、评价指标等）、原理和实现、实验结果与分析、总结和自评分、感谢和收获。

录制pre时候，左侧代码，右侧文档（如果是.jpynb文档，开一个窗口可以），自己头像可以放在右下角位置。



**作业评分标准**

| 标准                        | 等级                                            | 得分         |
| --------------------------- | ----------------------------------------------- | ------------ |
| 按时提交10～30分钟的present | 7 得分10+分钟，4 得分请假，0 得分未提交         | 7 分         |
| 源程序代码                  | 7 得分规范可读性好，4 得分有缺失，0 得分无源码  | 7 分         |
| 作业报告                    | 7 得分要求几部分完整，4得分有缺失，0 得分无报告 | 7 分         |
| 总得分：                    |                                                 | 21 ，满分 21 |







# 1 描述：

## 1.1 交易策略

柯蒂斯·费思. 海龟交易法则（第四版，Way of the Turtle： The Secret Methods that Turned Ordinary People into Legendary Traders）. 乔江涛，译. 中信出版集团，2021.12.

第十章 海龟式交易系统，参看附录B；

第十章使用第七章所讲到的某些标准来比较这些系统的相对表现，参考附录A。

附录C 给出了原版海龟交易法则，有更具体的细节举例和ATR计算等。 



海龟法则是很难坚持的，因为它们以捕捉相对罕见的大趋势为基础。正因为大趋势难得一见，所以你在迎来盈利期之前可能要等上好多个月，有时候甚至是一两年。在漫长的等待中，你很容易对海龟系统产生怀疑，忍无可忍地放弃这个系统。

如果你知道过去的20年中曾有过很多旷日持久的亏损期，你就更容易忍受一个历时8个月的亏损期。如果你知道快速补充头寸是系统盈利的一个关键环节，你就更容易遵守法则、快速行动。



## 1.2 实施路线

复现“第十章 海龟交易系统”中介绍的六个长期趋势跟踪系统。

测试的标的可以选择下面三者之一：

1）范围限制在美国市场，测试的市场组合包括澳元、英镑、谷物、可可、加拿大元、原油、棉花、欧元、欧洲美元、饲牛、黄金、铜、民用燃料油、无铅汽油、日元、咖啡、牛、猪、墨西哥比索、天然气、大豆、糖、瑞士法郎、银、中期国债、长期国债以及小麦。

2）如果这些行情数据不容易获得，可以找中国范围内流动性好的期货标的。

考虑到期货数据跳空影响数据连续性问题。如果能解决跳空问题，就使用期货标的。

> 数据处理探索——后复权详解（上）<br/>https://baijiahao.baidu.com/s?id=1662758093468142294&wfr=spider&for=pc<br/>大部分趋势性策略往往是非常低频的策略，很有可能一年之间只发生一两次交易，甚至好几年才有一次交易。在这种情况下，恐怕需要相当长时间的行情数据才能支持产生数十次交易信号。这就是我们遇到的问题：对于期货来说，每一个合约的行情数据至多只有一年，很难发生多次交易，这该如何做性能测试？ <br/><br/>数据处理探索——后复权详解（中）<br/>https://baijiahao.baidu.com/s?id=1663303792003300962&wfr=spider&for=pc<br/>差值复权对于期货品种来说却有致命的缺陷，那就是期货品种都有较为固定的基差，对于正向市场的连续差值复权会导致最后的价格变成负值。



3）再者可以考虑使用股票数据。 

例如：通过akshare库获取每只股票从2000年开始，每一天的数据，采用后复权。

后复权：保证历史价格不变，在每次股票权益事件发生后，调整当前的股票价格。 后复权价格和真实股票价格可能差别较大，不适合用来看盘。 其优点在于，可以被看作投资者的长期财富增长曲线，反映投资者的真实收益率情况。

> 什么是前复权、后复权和不复权<br/>https://zhuanlan.zhihu.com/p/364916709<br/>回测应该用后复权做历史回测。因为 “很多上市时间比较久的公司如果分红比较多，用前复权看以前的股价会出现负数的情况。这样就无法正确计算投资收益了。”



注意：

<span style="font-size:1rem; color:red;">股票与期货不同，A股的股票，买入时候1手对应是100股。期货有杠杠，每手只要交保证金就可以</span>。

例如：2024年4月22日10:45，螺纹钢 每手10顿，上期所，合约rb2410每手货值36850元，保证金4422元。

这样的话，期货或者股票，还可以按照投资粒度5000元左右人民币来设定。如果股价是60元，则一次花6000元左右（还有手续费）买100股。





# 2 问题：

在《漫步华尔街（原书第12版）》的6.4节中，讲到了“过滤”系统，该交易策略类似于《海龟交易法则》。

在微信读书app 中有《海龟交易法则（第四版）》这本书。

柯蒂斯·费思. 海⻳交易法则（第四版，Way of the Turtle： The Secret Methods that Turned Ordinary People
into Legendary Traders）. 乔江涛，译. 中信出版集团，2021.12.



请复现“第十章 海龟交易系统”中介绍的六个长期趋势跟踪系统。

请以一段时间内的真实行情数据，

1）给出如《海龟交易法则（第四版）》中“表10-1 6个系统的历史表现对比”的测试结果。

2）并给出相应的结果说明和分析。自己的收获和感想也可以写进去。如果不能按时完成，请写明大致花费时间，原因。

注：行情数据可以通过AkSahre接口获得。如果是针对股票数据，可以考虑设定账户规模是100万人民币，单个标的持仓上限是10万人民币。







# 附录A：第七章 如何衡量风险

理解风险、尊重风险，这就是顶尖交易者的标志。他们知道，如果你不去注意风险，风险就会找上门来。

当你在考虑一个以机械性交易系统为基础的交易策略，或者寻找一个使用这类策略的投资顾问时，你要问的一个关键问题（或许是唯一的问题）就是：“怎么才能知道一个系统或一个投资经理是好还是坏？”一般来说，业内人士给出的答案虽然五花八门，本质上却大同小异：谁的风险回报率最高，谁就是最好的。

每一个人都想在特定的风险水平下赚到尽可能多的钱，或者在特定的期望回报水平下承受尽可能小的风险。在这一点上，几乎所有人的看法都一致，无论是交易者、投资者、基金经理还是其他人。遗憾的是，对于风险回报率中的风险和回报这两个因素，以及关于什么是最佳的衡量标准仍存在诸多不同观点。有些时候，金融业对风险的定义太过狭窄，以至对某些特定的风险完全视而不见，但这些风险的破坏力丝毫不亚于他们关心的那些风险。

说到这些不在传统衡量范围内的风险，长期资本管理公司的崩溃就是一个很好的例证。本章将探讨这些风险和它们的衡量方法，然后根据历史数据提供一些评估交易系统风险和回报水平的一般技巧。

> 是的，长期资本管理公司（Long-Term Capital Management，简称LTCM）的崩溃是一个著名的例证，突显了损失厌恶和风险管理的重要性。
>
> LTCM成立于1994年，由一群诺贝尔奖得主和华尔街的精英投资者组成，他们运用复杂的数学模型和高度杠杆的交易策略来进行套利交易。LTCM采用了一种基于市场套利的交易策略，通过同时买入和卖出相互关联的金融资产，利用市场价格差异来获取利润。
>
> 然而，LTCM在风险管理方面出现了严重的失误。尽管他们的模型考虑了大量的市场变量和风险因素，但在1998年俄罗斯金融危机爆发时，市场出现了剧烈的波动，导致LTCM的交易策略出现了严重的偏差。由于采用了高度杠杆的交易，LTCM的损失迅速累积，最终导致了公司的崩溃。
>
> LTCM的崩溃揭示了几个重要的教训：
>
> 1. 风险管理的重要性：LTCM虽然拥有顶尖的数学家和金融专家，但由于未能有效管理风险，最终导致了灾难性的后果。这表明即使是最优秀的交易者也必须重视风险管理。
>
> 2. 损失厌恶的影响：LTCM的交易策略过于依赖复杂的数学模型，而忽视了损失厌恶对投资者行为的影响。在面对巨额损失时，投资者往往会采取过度保守的行动，加剧了市场的波动。
>
> 3. 杠杆交易的风险：LTCM采用了极高的杠杆比例进行交易，这加剧了其风险，并导致了巨大的损失。这再次强调了杠杆交易的潜在风险，需要谨慎对待。
>
> LTCM的崩溃成为了金融市场历史上的一个标志性事件，提醒人们在投资和交易中要谨慎行事，重视风险管理，避免过度依赖复杂的数学模型和高度杠杆的交易策略。

里奇和比尔对我们的头寸规模非常关心，因为他们知道，如果我们在不利的趋势中持有太大的头寸，他们甚至有倾家荡产的风险。在海龟计划开始前的几年，他们曾经历过白银市场设定跌停板的时期。纽约商品交易所对白银的每日最大变化幅度进行了限制，这意味着，如果没有交易者愿意在限价范围内买入，那么卖家根本没有退出的机会。这是期货交易者最大的噩梦。你的损失一天又一天地扩大，而你却无能为力。

幸运的是，里奇在噩梦发生之前就削减了他的头寸，这可能为他挽回了数千万美元的损失。如果他行动得不够快，他就可能失去一切。我相信，在海龟计划进行期间，这可怕的记忆一直萦绕在他的脑海中。

里奇一直在关注海龟们的头寸，如果他感到总体风险太大，就会削减头寸。人们普遍以为里奇是个胆大包天的赌徒，但在我看来，事实正相反，他非常注意他的风险水平。

## 1.四大风险

风险有很多种，衡量风险的方法也有很多种。有些大风险产生于相对罕见的事件中，10年也碰不到几次；有的风险则较为常见，一年内总会出现几次。大多数交易者都担心4种主要的交易风险：

- **衰落(Drawdowns)**：一连串损失使你的账户缩水。
- **低回报(Low returns)**：回报率太低，你赚到的钱微不足道。
- **价格动荡(Price shocks)**：一个或多个市场出现价格的骤然变动，导致无可挽回的重大损失。
- **系统死亡(System death)**：市场状态改变，致使曾经有效的系统突然失效。

让我们逐一看看这4种风险，然后考虑它们的衡量方法。要评估交易者和交易系统的风险回报比，我们可以综合利用这些方法。

### 衰落

衰落风险可能就是交易者放弃交易或是以失败收场的主要原因。请看图7-1中的净值曲线，它代表一个使用唐奇安趋势系统的10万美元账户从1996年1月到2006年5月的交易结果。

图中可见，这个账户的净值在10年多的测试期内以年均43.7%的复利水平增长，但也有一段衰落比例为38%的时期。

许多新手会被这类表现优异的系统吸引，心想：“盈利这么多，我当然可以承受那38%的损失。”遗憾的是，现实已经一次又一次地证明，人们对自己承受这类损失的能力并不是那么了解。如果你看到的只是像图7-1这样的图，那就更不用说了，因为这张图用的是对数刻度，其衰落幅度看起来要比在标准刻度下的衰落幅度小得多。

新手约翰对这个系统充满信心，而且相信自己有能力熬过衰落期，于是他在6月1日投入10万美元开始交易。图7-2包含图7-1的内容，只是将数据更新到了2006年10月末，而且用一个线性刻度展示了历史上的衰落期。

就在约翰入市后不久，系统进入了一个衰落期，而且这一次的降幅比之前的任何一次都要大一点儿：42%。这时候，约翰会想些什么？



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/image-20230329171524627.png" alt="image-20230329171524627" style="zoom: 50%;" />

图7-1　唐奇安趋势系统交易结果：1996年1月—2006年5月



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/image-20230329171552226.png" alt="image-20230329171552226" style="zoom:50%;" />

图7-2　唐奇安趋势系统交易结果：1996年1月—2006年10月

“万一这个系统不再管用了怎么办？”

“万一这只是一个大滑坡的开端怎么办？”

“万一我之前的测试方法有问题怎么办？”

“万一……怎么办？”

这些疑虑往往会促使一个新手放弃这个系统，或者开始有选择地交易，以期“降低风险”。这经常导致交易者错失本来可以赚钱的机会。伴随沮丧的情绪，在看到初始账户遭受1/2甚至更多的损失之后，交易者终于忍无可忍地退出了。这就是新手即使使用有效的策略也无法赚钱的原因：他们高估了自己在高风险水平下承受巨大波动的能力。

根据我的观察，大多数人都承受不住这样的衰落。一个对自己的交易能力、系统和测试结果充满信心的成功交易者或许可以承受一次巨大的衰落，但是一个谨小慎微的新手应该相应地调整风险水平，降低衰落的幅度。当然，这也意味着降低系统的回报水平。这是一种明智的妥协。

海龟们是幸运的，因为我们的老板理查德·丹尼斯知道，市场回调中的衰落与一连串败笔所造成的衰落不是一回事。他知道，对趋势跟踪者来说，返还一些利润只是游戏的一部分。

正因为如此，替这个老板管理资金是件轻松惬意的事。我们有时经历的某些大衰落足以让大多数投资者心惊胆战。有些海龟现在已经是募集外部资金的高手，但如果你看看他们的表现，就会发现，现在的他们已经远没有海龟时代大胆了。如果你想募集机构投资，谨慎实际上是个前提条件。

遗憾的是，如果你想像海龟那样获得100%以上的回报率，你就必须做好承受这类大衰落的准备。我估计我经历的最大一次衰落的幅度在70%左右，能承受这种波动的人恐怕不多。对大多数人来说，这在心理上是很难熬过的一关。

### 低回报

如果一个交易者想获得年均30%的回报率，他可以采用两种方式：使用一个可以稳定地获得30%年回报率的系统，或者使用另外一个不太稳定的系统——第一年赚5%，第二年赚5%，第三年赚100%。三年之后，两个系统的平均复合增长率都是30%。但是，大多数交易者更喜欢每年赚30%的稳定系统，因为这会让净值曲线更加平滑。

我们发现，在其他条件相同的情况下，一个能够稳定创造高回报的系统在未来任何一段时期内都更容易创造理想的回报。因此，在任何一年中，这样一个系统表现失常的风险都要低于那些历史记录不够稳定的系统。

### 价格动荡

价格动荡是指价格突然之间发生了快速的变化，一般来说，这是由自然灾害、出人意料的政治事件或经济灾难造成的。从我进入交易世界算起，美国共经历了两次严重的价格动荡，一次是1987年的股市崩溃和随后的反弹，另一次是2001年9月11日纽约世贸中心遭受恐怖袭击之后。

第一次动荡爆发时，我正在用一个2000万美元的账户为理查德·丹尼斯进行交易。我对这次灾难记忆犹新。我其实在股市崩溃的当天还赚了一点儿，但第二天，情况就完全不同了。

1987年10月19日，也就是“黑色星期一”，欧洲美元的收盘价为每股90.64美元，接近两天前创下的每股90.15美元的低点。当天早上，这个低点还曾经受考验，市场价格一度跌到了每股90.18美元。我持有空头，大约有1200份12月的欧洲美元合约和600份短期国债合约。同时，我还在黄金、白银和几种外汇上重仓持有多头。

次日一早，欧洲美元以每股92.85美元高开，跳高了两个点还多，相当于每份合约5500美元。我根本没有机会退出，这是8个月以来的最高价。另一边，黄金开在25美元以下，白银开在1美元以下。图7-3展示了欧洲美元市场在这个动荡日的巨变。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/image-20230329171723310.png" alt="image-20230329171723310" style="zoom:50%;" />

图7-3　1987年价格动荡中的欧洲美元

算起来，我为理查德·丹尼斯交易的那个2000万美元的账户损失了大约1100万美元。基本上，我全年的利润已经在一夜之间化为乌有。

令我哭笑不得的是，我在股市崩溃当天其实是小有收获的，政府不加警告突然降息的疯狂举动害惨了我。价格动荡不期而至。

请看图7-4，这是一个海龟使用唐奇安趋势系统的10万美元账户，从1984年到1987年年末的实战情况。

你可以清楚地看到那个代表65%跌幅的巨大缺口。请务必记住这个衰落是在一夜之间发生的。人们没有丝毫机会退出市场。还请注意，这一天内的跌幅比这个系统的任何一次历史测试的结果都要大一倍。换句话说，系统的历史测试会把衰落风险低估一倍。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/image-20230329171754085.png" alt="image-20230329171754085" style="zoom:50%;" />￼
图7-4　使用唐奇安趋势系统交易的账户3年的实战情况

在为自己的账户设定风险水平的时候，所有想生存下去的交易者都会谨慎地考虑价格动荡的现实。任何一个想获得高回报的人都要承受同样高的衰落风险——甚至有可能在一次巨大的价格动荡中输个一干二净。

### 系统死亡

所谓系统死亡，是指一个曾经有效或经过历史测试而看似有效的系统突然之间不再有效，开始赔钱。这种风险并不来自市场本身，而是由蹩脚的测试方式造成的。对那些根据近期价格波动进行最优化预测的短期系统来说，系统死亡的风险更大。

一个表现不佳的系统究竟只是处于正常的衰落期，还是真的不再有效？这对新手来说通常很难判断。我敢说，这可能是最令新手头疼的一件事。当他们碰上一次衰落时，他们会开始怀疑自己的方法：我的测试是不是有问题？是不是市场发生了某些变化，使我的方法变得无效了？这种情况还会持续下去吗？

我们将在以后的章节讨论降低系统死亡风险的方法。不过，现实是无奈的。由于市场是动态的，还包含其他许许多多的参与者，市场会变化是个无法改变的现实，而这会影响曾经有效的系统和方法。有时候，这些变化是永久性的。伟大的交易者与普通交易者的区别之一就在于他们有能力坚持其他人已经厌倦或放弃的方法，并且靠这些方法获得成功。

某些交易者因为怀疑某种方法而停止使用它，这对趋势跟踪者来说也会产生一种有趣的副作用。每过几年，趋势跟踪者就会经历一个亏损期，而每到这个时候，必然有专家跳出来宣称趋势跟踪策略已经是穷途末路了。这样一来，采用趋势跟踪策略的基金通常会遭遇大规模赎回的窘境。但当越来越多的资金撤离趋势跟踪策略的阵营后，这类策略反而重振雄风，大显神威。自海龟计划实施以来，我有三四次听到趋势跟踪法已经失效的论调。对此，我通常一笑了之，因为我知道，这意味着遍地黄金的市场已经离我们不远了。



## 2.风险的量化

使用任何一个系统都会经历痛苦的逆境时期，要把这一点考虑在内，风险的量化就是方法之一。量化风险的方法有很多，以下是几种我认为很有效的常用指标：

1.最大衰落(Maximum drawdown)：这是一个数字，代表一个测试期中从最高点到随后的最低点下跌的百分比。在图7-4中，最大衰落等于65%，这是1987年价格动荡的后果。

2.最长衰落期(Longest drawdown)：从一个顶峰到下一个顶峰的最长周期。它衡量的是市场的恢复速度，也就是在一段衰落期之后，价格需要多长时间才能重新到达新的高点。

3.回报标准差(Standard deviation of returns)：这是回报率分散状况的一个衡量指标。低标准差表明大多数时候的回报率都接近平均值，高标准差表明不同月份之间的回报率差异较大。

4.R平方值(R-squared)：这个指标衡量的是实际投资回报率与平均复合增长率的吻合程度。对带息账户这一类固定收益投资来说，R平方值等于1.0，而如果回报率不稳定，R平方值将小于1.0。



## 3.回报的量化

对一个特定的交易系统来说，回报是指你使用这个系统的期望回报。我们可以用很多种方法来量化回报，以下是我认为很有用的几种：

- **平均复合增长率(CAGR%, Compund Annual Growth Rate)**：平均复合增长率也称几何平均回报率，是指特定投资期内的平均复利率。期初资产按这个复利率滚动增长，将恰好增长到期末资产的水平。对简单的带息账户来说，平均复合增长率就是利率本身。在特定时期内，只要有一期的回报率特别高，整个平均复合增长率指标就会受到很大影响。

> 平均复合增长率（CAGR）是衡量某项投资或业务在一段时间内的年均增长率的指标。它考虑了投资或业务在每年的增长率，并将这些增长率进行复合，以计算出在整个时间段内的平均年增长率。
>
> CAGR的计算公式如下：
>
>
> 
> $CAGR = \left( \frac{{\text{终值}}}{{\text{初始值}}} \right)^{\frac{1}{n}} - 1$
> 
> 
>
> 其中：
>
> - 终值表示某个时刻的最终价值或终端价值；
> - 初始值表示同一时刻的初始价值或起始价值；
> - \(n\) 表示时间段的长度，通常以年为单位。
>
> CAGR的计算方法使得它能够有效地衡量在不同时间段内的增长率，即使增长率在时间段内波动较大，也能反映出长期趋势。这使得CAGR成为了评估长期投资或业务增长表现的一种常用指标。
>
> 举个例子，假设某项投资从初始值100增长到终值200，持续5年。那么该投资的CAGR计算如下：
>
>
> 
> $CAGR = \left( \frac{200}{100} \right)^{\frac{1}{5}} - 1 \approx 0.1487 \text{ 或 } 14.87\%$
> 
> 
>
> 这意味着该投资在过去5年内的平均年增长率为14.87%。



- **滚动平均一年期回报率(Average one-year trailing return)**：这是指连续滚动计算的一年期平均回报率。这个指标能更好地反映任何特定一年期内的典型回报水平。对跨度在几年以上的测试来说，这个指标对某个回报率特别高的时期相对不是那么敏感。



> 滚动平均一年期回报率是指在一段时间内，按照一年为单位对投资或资产的回报率进行滚动计算，并取平均值。这种方法可以用来评估资产或投资在长期时间内的表现，而不受单一时间点的影响。
>
> 具体步骤如下：
>
> 1. 首先，确定投资或资产的起始时间点和结束时间点。
> 2. 然后，以一年为单位，在这段时间内滚动计算每年的回报率。
> 3. 最后，取这些年度回报率的平均值，即为滚动平均一年期回报率。
>
> 例如，假设我们有某项投资，在2010年到2020年的时间段内，我们想计算其滚动平均一年期回报率。我们可以按照以下步骤进行：
>
> 1. 将时间段划分为2010-2011、2011-2012、...、2019-2020等每年为单位的时间段。
> 2. 对每个时间段内的投资回报率进行计算。
> 3. 将所有年度的回报率加总，然后除以年数，得到滚动平均一年期回报率。
>
> 这样计算得到的滚动平均一年期回报率可以反映出投资或资产在长期内的表现趋势，避免了受到单一时间点的影响。



- **平均月度回报率(Average monthly return)**：这是指测试期内各个月份的回报率平均值。





除了这些数字形式的指标，我还发现了几个有用的工具。一是净值曲线图本身，另一个是能突出月度回报分布状况的图表，就像图4-3那样。我还喜欢检验一段时期内各个月份的回报情况，就像图7-5一样。图7-5给出了唐奇安趋势系统1996年1月—2006年6月的月度回报率。

> 净值曲线图是一种用于显示投资组合或资产净值随时间变化的图表。它通常以时间为横轴，净值或资产价值为纵轴，展示了投资或资产的价值随时间的变化趋势。
>
> 绘制净值曲线图的步骤如下：
>
> 1. 收集数据：首先需要收集投资或资产在一段时间内的净值数据，通常是以每日、每周或每月为单位。
> 2. 绘制坐标轴：在图表上绘制横轴和纵轴，横轴代表时间，纵轴代表净值或资产价值。
> 3. 绘制曲线：根据收集到的净值数据，将净值点连接起来，形成曲线。每个净值点表示特定时间点的投资或资产净值。
> 4. 添加标签和标题：为图表添加标签，包括横轴和纵轴的标签，以及图表的标题，以提供更多的信息和解释。
>
> 净值曲线图可以帮助投资者了解他们的投资组合或资产价值随时间的变化情况。通过观察曲线的走势，投资者可以评估投资的表现，了解投资的风险和收益特征，并做出相应的投资决策。
>
> 例如，假设我们有一个股票投资组合，我们可以绘制一个净值曲线图，显示这个投资组合的净值随时间的变化情况。曲线的上升或下降可以帮助我们评估投资的表现，并根据需要做出调整。



![image-20230327215443864](https://raw.githubusercontent.com/GMyhf/img/main/img/841ynh.png)

图4-3　月度回报分布图



我发现，像图7-5这样的图能很好地反映风险与收益的权衡，比单独的一个或一组数据要生动得多。



![image-20230327215125700](https://raw.githubusercontent.com/GMyhf/img/main/img/v22iip.png)

图7-5　唐奇安趋势系统月度回报率：1996年1月—2006年6月





## 4.衡量风险与回报的综合指标

比较不同的交易系统或使用交易系统的投资经理，有几种常见的综合指标可用。最常用的两个指标是夏普比率和MAR比率。

### 夏普比率(Sharpe Ratio)

夏普比率可能是退休基金和大投资者在比较潜在投资目标时最常用的指标。夏普比率由诺贝尔奖获得者威廉·F.夏普于1966年提出，用于比较共同基金的业绩。这个指标最初被称作回报-波动性比率，后来被冠以创始人的名字，简单地称作夏普比率。

**夏普比率**是这样得出的：首先计算考察期内的超额回报率（也就是这段时期的月度或年度平均复合增长率减去所谓的无风险回报率，或者减去短期国债之类的无风险债券的利率），然后把它除以其间回报率（一般是月度或年度回报率）的标准差。请记住，夏普比率是为比较共同基金的表现而发明的，并不是一个一般性的风险回报率指标。共同基金是一种非常特殊的投资工具，主要做股票组合的非杠杆投资。
夏普比率是用于比较共同基金的，其原始定位也对不在它涵盖范围内的风险提供了重要的提示。夏普比率是1966年提出的，当时的共同基金只做美国股票组合的非杠杆投资。因此，共同基金比较的是相同市场上的投资，而且是投资策略基本相同的投资。

另外，当时的共同基金普遍用于股票组合的长期投资。由于不存在时机选择和交易方式等因素的影响，不同基金之间的区别仅在于组合选择和分散化策略的不同。因此，在衡量共同基金的表现时，夏普比率能很好地代表风险水平，因为它正确地反映了一个事实：对同时期的比较来说，风险水平与回报的波动性直接相关。在其他条件相同的前提下，波动性较低的共同基金更不容易偏离它的历史平均回报水平。

但是，尽管夏普比率是比较股票组合管理策略的一个绝好的风险回报率指标，它对期货对冲基金这一类另类投资基金来说却并不是一个足够好的比较指标。之所以这么说，是因为这些另类投资基金在几个重要的风险层面上与无杠杆的股票组合并不相同：

- **管理策略风险**：期货系统和期货基金往往会使用短期的交易策略，这些策略与传统投资基金长期持有的策略有天壤之别。在使用这种需要频繁买入和卖出的交易策略时，损失的速度可能会快得多。
- **分散化策略风险**：许多期货基金和交易系统的内在分散化程度达不到传统股票基金那样高的水平，大部分资产往往集中在少量工具上。
- **潜在风险**：期货交易的杠杆水平要高于股票，这在无形之中使期货交易者承受了更大的市场波动风险。
- **信心风险**：许多期货基金经理并没有太详细的履历。在缺乏可参考的履历的情况下，投资者得不到期望回报的风险就会提高。

遗憾的是，夏普比率的流行似乎使我在这个行业中发现的一个问题更严重了：把回报的稳定性当成风险水平的唯一衡量标准。对那些不懂交易，不明白交易策略与传统股票投资的持有策略有何不同的人来说，这个问题尤其严重。

我必须强调一点：稳定性并不等于低风险，风险非常高的投资也有可能在有限的时期内创造稳定的回报。投资者很容易相信，在几年的时间内能一直保持正回报率的投资或投资经理就是安全的选择。他们只是盲目地怀有这种信念，却往往并不知道这些回报是怎么得来的。

我相信，在很多情况下，回报的稳定性越高，实际风险水平就越大。我可以给出两个例子：一个是美国长期资本管理公司，它所使用的策略在最初几年相当成功，但随后就彻底失效，演变为一场灾难；另一个是许多基金至今仍在使用的策略，它的表现非常出色，但同样有瞬间崩溃的风险。

美国长期资本管理公司的策略有两个基础：一个是非常高的杠杆率，另一个是固定收益债券的价格在特定情况下的统一化趋势。极高的杠杆率使它的头寸规模庞大之极，因此当遭受损失时，它很难全身而退。

这个策略曾在几年内十分有效，但当俄罗斯债券违约事件所制造的金融危机引发了一次不利的波动时，美国长期资本管理公司的规模反而害了它。因为市场上的其他阵营都知道，它们可以让价格继续向不利于美国长期资本管理公司的方向变化，美国长期资本管理公司早晚要被迫逆转其头寸。最终，美国长期资本管理公司几乎把家底赔了个精光，而在崩溃之前，它的价值是47亿美元。

在危机之前，美国长期资本管理公司的年均回报率几乎达到40%，而且表现相当稳定。换句话说，它的夏普比率很出众。你可以在罗杰·洛温斯坦的《营救华尔街》一书中了解到美国长期资本管理公司陨落故事的更多细节。

最近，对冲基金阿曼尼的天然气交易也出了类似的问题。同美国长期资本管理公司一样，阿曼尼的头寸相比其他交易者来说过于庞大了。90亿美元在短短两个月之内就损失了65%。在此之前，它的夏普比率也很不错。

现在，有很多对冲基金靠货币期权交易赚钱，这意味着它们赌的是价格的剧变。如果风险能得到有效的管理，这就是一种非常有效的策略，能提供非常稳定的回报。

问题是，这些基金所面临的实际风险对外行人来说是很难理解的。它们有可能一边创造着丰厚而又稳定的回报，一边又严重暴露在各种价格动荡的风险中。例如，1987年欧洲美元期权的任何一个卖方都有可能倾家荡产。价格动荡中的损失，再加上期权履约的风险，完全可能令一天内的损失超过整个基金的价值。

谨慎的基金经理会控制这些风险。遗憾的是，许多投资者并不知情，等他们意识到这些风险时，往往为时已晚，他们已经失去了一切。他们是被基金的稳定回报率和多年来的良好表现诱惑而来的，殊不知，这些基金还没有经历过真正的艰险时期。



### MAR比率

MAR比率是Managed Accounts Reports（管理账户报告有限公司）发明的一个指标，这个公司专门提供对冲基金的业绩报告。MAR比率等于年均回报率除以最大衰落，最大衰落是根据月末数据计算的。这个比率是风险回报比率的一个相当快捷而又直接的衡量指标，我发现用它来剔除表现不佳的策略是非常有效的。对粗略的分析来说，它是一个绝好的工具。以唐奇安趋势系统为例，在上文所说的1996年1月—2006年6月的测试期中，系统的MAR比率是1.22，其中，平均复合回报率为27.38%，用月末数据计算出的最大衰落是22.35%。

我发现用月末数据计算衰落幅度有点儿缺乏根据，它经常会低估实际的衰落程度。因此，我<u>在自己的测试中使用的是从最高点到最低点的跌幅，没有考虑这些最高点和最低点是一个月中的哪一天</u>。要想知道这种方法与单纯使用月末数据有什么区别，看看我的计算结果就行了：包括非月末日在内的实际衰落不是22.35%，而是27.58%，因此实际MAR比率是0.99，而不是刚才的1.22。



## 5. 模仿效应与系统死亡风险

说到交易的系统、策略和表现，我所观察到的最有趣的现象之一就是模仿效应：在风险回报比率上拥有傲人记录的那些策略往往是最容易被整个行业模仿的策略。它们刚刚崭露头角，立即就被数十亿美元竞相追随，结果反而自毁长城，因为它们的规模已经超出了市场的承受能力。到头来，它们早早就成了系统死亡的牺牲品。

在这一点上，套利策略可能是最好的例子。最纯粹的套利实际上是一种没有风险的交易。你在一个地方买入某个东西，在另一个地方把它高价卖掉，扣掉运输或仓储成本，剩下的都是你的利润。大多数套利策略都不会完全没有风险，但有很多几乎没有风险。问题是，靠这样的策略赚钱是有前提条件的，那就是不同地方的同一种工具存在价差，或者一种工具和另一种同类工具之间存在价差。

**使用某一种特定策略的人越多，价差就消失得越快，因为这些交易者本质上都在争夺同样的机会。长此以往，这种效应会毁掉这种策略，因为使用它会变得越来越无利可图。**

**相反，对一般投资者没有吸引力的系统和策略反而有更长的生命周期。趋势跟踪就是个很好的例子。大多数大投资者都很难忍受使用趋势跟踪策略时常见的大衰落和价值波动。正因为这样，趋势跟踪策略将在长期内始终有效。**

不过，趋势跟踪策略的回报水平是周期性的。每当大量资金在一段相对稳定的回报期后跟风涌入，通常会出现几个相对艰苦的年头，因为有太多投资者在同样的市场中使用同样的策略，市场无法轻松消化这么多的资金。相反，当投资者在经历一段相对艰苦的时期后纷纷撤走他们的资金时，好日子通常又会再度来临。

切忌要求过高：如果你在检验一种策略的时候太过贪婪，你更有可能得不到你想要的结果。历史记录看似高人一筹的策略也最有可能引来新的追随者，当新来者纷纷加入时，这些策略往往很快就变得不再神奇。

我们每个人都有不同的风险承受能力和回报期望。因此，世界上不存在对所有人都有吸引力的万能指标。**我曾经综合使用MAR比率、最大衰落和总体回报这三个指标，同时还通过观察夏普比率和R平方值来判断回报稳定性。**最近我又设计了一些新指标，可以说是这些常用指标更稳定的版本。我将在第十二章介绍这些指标。

我也会尽力避免被某些特殊数据迷惑，因为我知道，未来不等于现在，一种策略现在有1.5的MAR比率并不意味着它能在未来保持这样的水平。







# 附录B：第十章 海龟式交易系统

简单一点儿。操作得当的定时退出法总能击败那些复杂、花哨的梦幻方法。

本章将介绍一些海龟式交易系统，也就是通常所说的长期趋势跟踪系统。它们是：

- **ATR通道突破系统（ATR CBO, ATR Channel Breakout）**：一个波幅通道系统，它将ATR视作波动性指标。
- **布林线突破系统（Bollinger Breakout）**：一个波幅通道系统，它的波动性指标是标准差。
- **唐奇安趋势系统（Donchian Trend）**：一个带有趋势过滤器的突破系统。
- **定时退出唐奇安趋势系统（Donchian Trend with Time Exit）**：一个带有趋势过滤器的突破系统，它使用定时退出策略。
- **双重移动平均线系统（Dule Moving Average）**：在短期移动平均线穿越较长期移动平均线时买入或卖出的系统。与其他系统不同的是，这个系统始终不离市场，无论是做多还是做空。
- **三重移动平均线系统（Tripple Moving Average）**：这个系统也在短期移动平均线穿越较长期移动平均线时买入或卖出，但前提是穿越方向符合大趋势（根据一条最长期的移动平均线来判断）。

为了检验这些系统的区别，我对它们分别进行了历史测试，目的是看一看每个系统在过去10年中能赚到多少钱。本章将使用第七章所讲到的某些标准来比较这些系统的相对表现。



## 1.历史测试

历史测试也被称作事后检验。有许多交易者不相信历史测试，其中还包括不少成功的交易者。他们认为，用历史数据做测试是没有意义的，因为过去并不代表未来。对那些不熟悉这场争论的读者来说，我将花一点儿篇幅向你解释一件你可能认为不需要解释的事。对那些不相信历史测试的人来说，我想问这么几个问题：你还有别的方法吗？不了解过去，你怎么制定策略？你怎么决定何时买入或卖出？难道靠瞎猜吗？

你能掌握的唯一信息就是市场迄今为止的表现。即使你是一个随机而动的交易者，不使用任何的法则或系统，你也会把过去的经验当作一种指南。你依赖的是对过去的解读；事实上，你依赖的是历史数据。

聪明的自主交易者可能会在多年的实践之后开发出自己的系统。他们观察到了蕴藏着盈利机会的重复性模式，于是设计出了利用这些机会的交易策略。<u>新手在入市之前常常会先花上几个月的时间好好研究一下过去的走势图，了解过去的市场是怎样变化的。因为他们知道，关于市场的未来趋势，最好的指南就藏在历史中。</u>

不难证明，计算机可以用同样的历史数据更有效地检验一个理念。凭借计算机模拟测试，交易者可以在实际行动之前对某种特定的策略进行更严格的检验。他们常常会发现，由于某些未能预见的因素，看似充满希望的理念其实是无效的。显然，用计算机来提早发现这一点比在实战中吃一堑长一智要好得多。

<u>一些交易者之所以不相信历史测试，是因为这种事后测试经常被歪曲。有人借用计算机的力量发现了一种看似有效的方法，但在真正的市场中却大败而归，这样的问题很容易出现。这些问题是可以克服的，只要你能避免最常见的隐患：过量优化。</u>第十一章会谈到这个问题。

正确的历史测试所需要的某些经验和技巧是新手不具备的。不过，虽说一把锋利的刀子不能交给一个小孩子，但它在厨房里是可以派上用场的。你只需小心使用那些锋利的工具就是了。

历史测试并不能预见未来，但它可以帮助你判断一种方法能否在未来盈利。它并不是最优的方法，水晶球或时光机都比它要好，但它是目前可用的工具中最好的一个。

| 被神化了的专家<br/><br/>“不要最优化”这种误人子弟的专家建议源自交易世界里的一种现象，我和我的朋友们喜欢称之为被神化了的专家。遗憾的是，在大多数领域中，真正的专家寥寥无几。每一个真正的专家都被淹没在大批冒牌专家之中。这些冒牌专家在行业里占据了一席之地，东拼西凑了不少知识，在外行人的眼中，他们与真正的专家没什么区别。他们也有作用，但他们并不是真的理解他们所混迹的领域。<br/><br/>真正的专家没有一成不变的法则；他们胸有成竹，所以他们不需要僵化的法则。<br/><br/>但冒牌专家并不懂行，所以他们喜欢观察专家、模仿专家。他们知道怎么做，但他们并不知道为什么这么做。所以，他们照着专家的样子设置的那些严格的法则，没有一个符合专家的本意。<br/><br/>冒牌专家有一个明显的标志：他们的文章写得晦涩不清、难以理解。写不清楚，是因为想不清楚。一个真正的专家却可以把复杂的概念解释得简明易懂。<br/><br/>冒牌专家还有一个共同特征：他们知道如何应用复杂的程序和技巧，也受过良好的培训，但他们并不知道这些技巧的局限性。<br/><br/>说到交易行业，历史测试就是个好例子。某个人会做复杂的统计分析，于是他做了一次模拟检验，生成了1000笔交易，然后就自认为可以从这些交易中得出结论，殊不知这样的结论可能只是从两星期的短期数据中得出的。这类人会运用数学计算，但并不明白一个简单的道理：如果下一周的情况与上两周大相径庭，数学计算也没用。<br/><br/>不要把经验与专家技能混为一谈，也不要把知识与智慧混为一谈。 |
| ------------------------------------------------------------ |





## 2.测试参数

本章所说的测试使用的是一个常见的市场组合和一种常见的资金管理法则，这是为了明确测试结果的差异，使它们区别于法则变化所导致的差异。以下是测试中所使用的参数。



### 市场组合

我们所测试的市场组合包括澳元、英镑、谷物、可可、加拿大元、原油、棉花、欧元、欧洲美元、饲牛、黄金、铜、民用燃料油、无铅汽油、日元、咖啡、牛、猪、墨西哥比索、天然气、大豆、糖、瑞士法郎、银、中期国债、长期国债以及小麦。

这些市场都是从美国的高流动性（交易量较大）市场中挑选出来的。也有几个高流动性的市场被剔除了，因为它们与其他高流动性市场具有高度相关性。我们把测试范围限制在美国市场，是因为许多历史数据供应商只是零零星星地提供有关美国以外市场的信息——碍于这个原因，许多新手交易者一开始只做美国市场的交易，而我们想尽可能使交易者便于把我们的测试结果应用到他们自己的交易中。



### 资金管理法则

这里所使用的资金管理法则与海龟的方法相同，只不过在一个指标上更保守了一些。海龟的标准是1ATR等于交易资本的1%，而我们的标准是0.5%。也就是说，在为一个给定市场计算合约数量的时候，我们用账户净值的0.5%除以这个市场在交易发生时的ATR值。



### 测试期

这次测试使用的是1996年1月—2006年6月的数据，所有系统都是如此。



## 3.六个系统



在揭示测试结果之前，让我们先来更详细地看一看各种系统。

### ATR通道突破系统

ATR通道突破系统是一个波幅通道系统，它把真实波动幅度均值（即ATR）用作波动性指标。350日移动平均收盘价加上7个ATR就是通道的顶部，减去3个ATR就是通道的底部。如果前一日的收盘价穿越了通道顶部，则在今日开盘时做多；如果前一日的收盘价跌破通道底部，则在开盘时做空。当收盘价反向穿越了移动平均线，交易者就会退出。

> ATR是Average True Range的缩写，中文意为“平均真实波幅”。ATR是一种技术指标，广泛应用于股票、期货、外汇等金融市场的技术分析中。
>
> ATR指标的计算基于股价的波动性，它衡量了市场价格波动的幅度，而不考虑价格的方向。具体而言，ATR指标是过去一段时间内价格波动的平均值。一般情况下，ATR的计算周期是14天，但也可以根据交易者的偏好进行调整。
>
> ATR通道突破系统是一种基于ATR指标的交易策略。它通过计算价格的波动范围，然后根据波动范围构建上下两条通道线，当价格突破这些通道线时发出买入或卖出信号。通道线的宽度通常是ATR值的一个倍数，例如2倍或3倍。
>
> 这种交易系统旨在捕捉价格波动的趋势，并据此进行交易决策。当价格突破通道线时，可能意味着市场出现了新的趋势或趋势加速，交易者可以根据突破方向采取相应的交易动作。

交易者马克·约翰逊在查克·勒博的系统交易者俱乐部论坛（www. Traderclub.com）上普及了一种叫作PGO（Pretty Good Oscillator，绝佳振荡器）的系统，这就是ATR通道突破系统的一种变体，也是下面所说的布林线突破系统的一个变体。图10-1就是ATR通道突破系统的一个波幅通道。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/uvk42a.png" alt="image-20230327225825269" style="zoom: 33%;" />

图10-1　ATR通道突破系统的一个波幅通道

中间的曲线是350日移动平均线，顶部的曲线就是350日移动平均线加7ATR所得出的波幅通道的顶部。



### 布林线突破系统

这个系统由查克·勒博和戴维·卢卡斯在他们1992年的著作《技术交易者期货市场电脑分析指南》中提出（计算移动平均价的时间和计算波幅宽度的标准差有所变化）。布林线是由约翰·布林发明的一种波幅通道。这个系统的布林线是通过350日移动平均收盘价加减2.5倍标准差而得出的。如果前一日的收盘价穿越了通道的顶部，则在开盘时做多；如果前一日的收盘价跌破通道的底部，则在开盘时做空。图10-2是布林线突破系统的波幅通道。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/d5x5y1.png" alt="image-20230327225950602" style="zoom:33%;" />

图10-2　布林线突破系统的波幅通道



### 唐奇安趋势系统

我们曾在第五章说过唐奇安趋势系统，它是当年海龟系统的一个简化版本。它采用20日突破入市策略，10日突破退出策略，还有一个350日/25日指数移动平均趋势过滤器。交易者严格遵守短期移动平均线所指示的方向：如果25日平均线在350日平均线之上，只能做多；如果25日平均线在350日平均线之下，只能做空。这个系统还规定了2ATR的止损退出点，这与原版海龟系统相同。图10-3是唐奇安趋势系统的突破位和移动平均线。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/3jmvad.png" alt="image-20230327230108055" style="zoom:33%;" />￼
图10-3　唐奇安趋势系统的突破位和移动平均线

与价格走势高度吻合的那条平滑的曲线是短期移动平均线，图形底部的那条平滑的曲线是长期移动平均线。图中可见，一个长期的向上趋势正在进行中，因此只能做多。价格信息顶部和底部的两条错落不齐的曲线就是突破位。每当市场创下一个新高时，最高点都会直接刷新，因此向上突破位的曲线与价格走势非常吻合。注意，由于价格呈上升趋势，向下突破位（前期最低点）与价格走势的吻合程度并没有这么高。

根据这个图，4月10日时应该做多，因为价格在这一天穿越了3月7日创下的0.6802美元的前期最高点。请注意，3月底时市场曾尝试突破这个高点，但未能成功。这是阻力作用的一个好例子。当价格第二次上升到这个水平时，市场终于突破阻力，而且一口气连涨6美分，直至0.74美元也没有明显的回调。之所以突破成功，是因为不再有交易者愿意在这个价位卖出，但却有交易者愿意在更高的价位买入。



### 定时退出唐奇安趋势系统

定时退出唐奇安趋势系统是唐奇安趋势系统的一个变体，它采用的是定时退出策略，而不是突破法退出策略。它在80天之后退出，没有任何形式的止损点。有很多交易者声称入市点并不重要，重要的是退出点。这个系统就是我对他们的答复。当我们稍后比较各个系统的表现时，你会看到这个非常简单的退出策略比那些复杂的退出策略更胜一筹。



### 双重移动平均线系统

这是一个非常简单的系统，只在100日平均线穿越350日平均线时买入或卖出。与其他系统不同的是，这个系统始终不离场，无论是做多还是做空。唯一的退出点就是短期平均线穿越长期平均线时：此时，交易者退出上一笔交易，开始一笔相反方向的新交易。图10-4是双重移动平均线系统的移动平均线。
100日平均线与价格走势更加吻合，当它在7月底向上穿越350日平均线时，交易者会做多。你可能会发现，这个系统属于一个相当长期的趋势跟踪系统，交易频率比其他大多数系统都要低。

### 三重移动平均线系统

这个系统使用三种移动平均线：150日、250日和350日平均线。交易者在150日平均线穿越250日平均线时买入或卖出。最长期的350日平均线扮演的是趋势过滤器的角色。只有150日和250日平均线位于350日平均线的同一侧时才能交易。两者都高于350日平均线时，只能做多；两者都低于350日平均线时，只能做空。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/nj8my0.png" alt="image-20230327230418575" style="zoom:33%;" />￼
图10-4　双重移动平均线系统的移动平均线

与双重移动平均线系统不同的是，这个系统并非始终不离场。交易者在150日平均线穿越250日平均线时可能退出。图10-5是三重移动平均线系统的三条移动平均线。

最上面一条是150日平均线，中间一条是250日平均线，最下面一条是350日平均线。可以看到，在与图10-4相同的时间段内，三条线全部随着价格的上涨而缓慢上升。如果最上方的平均线掉过头来向下穿越中间的平均线，那么系统会退出交易。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/yqmmf9.png" alt="image-20230327230749658" style="zoom:33%;" />

图10-5　三重移动平均线系统的移动平均线
在我们开始讲下一节之前，请先猜一猜这些系统在这段测试期内的表现孰优孰劣。定时退出系统的表现比普通的突破法退出策略差多少？哪两个系统的MAR比率最高？三重移动平均线系统的表现比双重移动平均线系统强多少？



## 4.测试结果

我用同样的数据（同样的资金管理法则、市场组合和测试期）和我们自己的交易模拟软件Trading Blox Builder对6个系统做了测试。这个软件模拟了每个系统在1996年1月—2006年6月的每一次交易，并据此生成了业绩统计表。表10-1列出了每个系统最主要的业绩指标值。



表10-1　6个系统的历史表现对比

| 系统         | CAGR（%） | MAR比率 | 夏普比率 | 交易次数 | 交易成功率(%) | 最大衰落(%) | 衰落持续期 |
| ------------ | --------- | ------- | -------- | -------- | ------------- | ----------- | ---------- |
| ATR通道突破  | 49.5      | 1.24    | 1.34     | 206      | 42.2          | 39.9        | 8.3        |
| 布林通道突破 | 51.8      | 1.52    | 1.52     | 130      | 54.6          | 34.1        | 7.8        |
| 唐奇安趋势   | 29.4      | 0.80    | 0.99     | 1832     | 39.7          | 36.7        | 27.6       |
| 唐奇安定时   | 57.2      | 1.31    | 1.35     | 746      | 58.3          | 43.6        | 12.1       |
| 双重平均线   | 57.8      | 1.82    | 1.55     | 210      | 39.5          | 31.8        | 8.3        |
| 三重平均线   | 48.1      | 1.53    | 1.37     | 181      | 42.5          | 31.3        | 8.5        |



当我第一次测试定时退出策略时，我大吃一惊。它们的表现比我想象中好得多，甚至比突破法退出策略还好。如果说一个系统的威力在于它的退出策略，这就是最好的证据。这说明，一个系统的盈利能力并不完全依赖于一个有优势的入市策略。

请注意，唐奇安系统的表现不如其他系统。这说明，突破法在海龟计划实施之后的岁月中已经丧失了一些优势。我认为这在很大程度上是**交易者效应**造成的。我将在第十一章谈谈这种效应。

表10-1的另一个让人吃惊的地方是双重平均线系统的优异表现。注意，这个系统的业绩要优于与其同属一类但更复杂的三重平均线系统。这个例子证明了更复杂的系统未必更好，而且同样的例子还有很多。

这些都是基础性的系统。其中，双重平均线、三重平均线和唐奇安趋势这三个系统甚至没有任何的止损退出标准。这意味着它们违背了最受尊崇的交易格言之一——永远要有止损点。但它们的风险调整回报率却可与其他系统比肩，甚至强于其他系统。





## 5.要不要加入止损点？

完全没有止损退出标准会令很多交易者惴惴不安。如果我们加入止损点，双重平均线系统的表现会有什么变化？很多人喜欢琢磨这类事情。他们会带着这些问题去请教他们的朋友或更有经验的交易者。

对我来说，如果我在检验了一个理念之后得到了实实在在的肯定回答，我更愿意对这种理念抱有信心。信心是有益的。图10-6反映了不同止损点下的MAR比率，横轴代表止损点，以入市时的ATR为单位。

注意，止损点为零时，也就是根本没有止损点时，MAR比率最高。事实上，这个结论对所有指标来说都成立：平均复合增长率、MAR比率、夏普比率、最大衰落、衰落持续期——每一个指标。三重移动平均线系统同样如此：如果加入止损点，那么每一个指标都会变坏。对定时退出唐奇安趋势系统的止损点测试也几乎得出了同样的结论，只有一个例外：对10ATR以上的大止损点来说，系统表现与没有止损点的时候差不多。这当然与“永远要有止损点”的一般信念非常矛盾。为什么？止损点不是对保住本钱很重要吗？既然我们加入了止损点，衰落水平为什么不下降呢？

许多交易者认为，最需要担心的是一连串接踵而至的损失。这对每笔交易不过维持几天的短期交易者来说或许是事实，但对趋势跟踪者来说不是。对趋势跟踪者来说，衰落也来自趋势逆转，这通常发生在大趋势结束之后。有时候，趋势逆转之后的市场非常不稳定，操作起来相当棘手。

海龟们都知道，放弃在趋势中积累起来的部分利润只是游戏的一个部分。我们知道我们早晚会经历巨大的衰落。但这对某些海龟来说确实是件痛苦的事，特别是那些最受不了赔钱的海龟。目睹刚刚赚到的钱烟消云散是我们在交易中最难忍受的一个环节。



<img src="https://raw.githubusercontent.com/GMyhf/img/main/img/f3nnh0.png" alt="image-20230327231911966" style="zoom:33%;" />￼
图10-6　双重移动平均线系统中不同止损点下的MAR比率（以入市时的ATR为单位)

因此，趋势跟踪者的衰落并非来自入市风险，而是来自利润返还。我们会在第十一章更详细地讨论这个问题，现在先回到6个系统的测试结果上。





## 6.测试结果发生了变化

前面说过，我们的测试期截至2006年6月。当我写到这里的时候，又有很多个月过去了，你可能对这段时间内的情况感到很好奇。
如果以截至2006年6月的数据为依据，你会选择哪一个系统？如果你能选择两个系统，你会选择哪两个？为了给你一点儿启示，我修改了测试截止日期，加入了直至2006年11月的新数据，更新后的结果如表10-2所示。



表10-2　截至2006年11月的系统历史表现对比

| 系统         | CAGR（%） | MAR比率 | 夏普比率 | 交易次数 | 交易成功率(%) | 最大衰落(%) | 衰落持续期 |
| ------------ | --------- | ------- | -------- | -------- | ------------- | ----------- | ---------- |
| ATR通道突破  | 49.5      | 1.15    | 1.27     | 216      | 43.1          | 40.0        | 8.3        |
| 布林通道突破 | 49.2      | 1.44    | 1.47     | 136      | 53.7          | 34.1        | 7.8        |
| 唐奇安趋势   | 29.4      | 0.75    | 0.94     | 1901     | 38.7          | 38.7        | 27.6       |
| 唐奇安定时   | 57.1      | 1.31    | 1.34     | 773      | 59.1          | 43.6        | 12.1       |
| 双重平均线   | 49.1      | 1.94    | 1.34     | 222      | 36.9          | 47.2        | 8.3        |
| 三重平均线   | 41.2      | 0.97    | 1.21     | 186      | 41.9          | 42.3        | 8.5        |



稍微看一眼CAGR和MAR比率就能发现，趋势跟踪系统在2006年的最后几个月中整体表现不佳。有趣的是其中所发生的变化，表10-3列出了CAGR和最大衰落变化的百分比。

表10-3　CAGR和最大衰落变化的百分比（单位：%）

| 系统         | CAGR（截止2006年11月） | CAGR（截止2006年6月） | 最大衰落变化 | 最大衰落（截止2006年11月） | 最大衰落（截止2006年6月） | 最大衰落变化 |
| ------------ | ---------------------- | --------------------- | ------------ | -------------------------- | ------------------------- | ------------ |
| ATR通道突破  | 45.9                   | 49.5                  | -7.3         | 40.0                       | 39.9                      | 0.3          |
| 布林通道突破 | 49.2                   | 51.8                  | -5.0         | 34.1                       | 34.1                      | 0.0          |
| 唐奇安趋势   | 27.4                   | 29.4                  | -6.8         | 38.7                       | 36.7                      | 5.4          |
| 唐奇安定时   | 57.1                   | 57.2                  | -0.2         | 43.6                       | 43.6                      | 0.0          |
| 双重平均线   | 49.1                   | 57.8                  | -15.1        | 47.2                       | 31.8                      | 48.4         |
| 三重平均线   | 41.2                   | 48.1                  | -14.4        | 42.3                       | 31.8                      | 35.1         |





这是怎么回事？测试结果为什么会发生这么大的变化？最佳系统的衰落幅度为什么会上升50%之多？为什么使用最简单的定时退出策略的系统在最后的5个月中没有什么变化，但其他系统却如此糟糕？一个交易者如何建立更符合期望值的系统？换个角度说，你怎么才能让你的期望值与一个系统的潜力更加吻合？

这些问题可以作为下一章的导言。在第十一章，我们将探讨这些问题，帮助你更好地理解历史测试结果和实际交易结果的差异，也更好地理解导致这种差异的种种因素。







# 附录C：附 原版海龟交易法则



我说过很多次，你可以把我们的交易法则登在报纸上，但没人会遵守它们。关键是统一性和纪律性。几乎每个人都可以列出一串法则，而且不比我们的那些法则差多少，但不是每个人都能给别人信心。唯有对法则充满信心，你才会坚持遵守它们，即使在遭遇逆境时也是一样。

<div style="text-align: right"> ——理查德·丹尼斯，摘自杰克·D.施瓦格《金融怪杰》 </div>

​																	



## 1.完整的交易系统

大多数成功的交易者都使用机械性的交易系统。这并非偶然。一个好的机械性交易系统可以自动完成整个交易过程，代替交易者做出每一个必要的决定。有了它，交易者更容易保持策略的统一性，因为系统的一整套法则已经明确而又严格地限制了每一个操作细节。交易技巧与交易者的主观判断毫无关系。

如果你知道你的系统能在长期内赚钱，你就更容易在逆境时期坚持遵守交易信号的指示，根据系统的命令采取行动。如果你依赖的是自主判断，那么你也许会发现，你往往在应该大胆的时候畏首畏尾，在应该谨慎的时候却莽撞激进。

如果你有一个有效的交易系统，而且能坚定不移地遵守它的要求，你的行动就会更具统一性，尽管连续的损失或巨大的盈利也会激起你内心的思想斗争。一个千锤百炼的机械性交易系统能赋予你信心、统一性和纪律性，这就是许多顶尖交易者的成功秘诀。

海龟交易系统是一个完整的交易系统。它的法则囊括了交易的每一个环节，没给交易者留下任何主观思考的余地。它有一个完整的交易系统所应该有的所有成分，涵盖了成功交易的每一个必要决定：

- 市场：买卖什么？
- 头寸规模：买卖多少？
- 出入市：什么时候买卖？
- 止损：什么时候放弃一个亏损的头寸？
- 退出：什么时候退出一个盈利的头寸？
- 战术：怎么买卖？

### 市场：买卖什么？

第一个必须要做的决定就是买卖什么产品，从本质上说，这就是选择市场的过程。如果你选择的市场太少，你抓住趋势的概率就会大大降低。另外，你也不希望不加区分地随意选择那些容量太小或鲜有趋势的市场。



### 头寸规模：买卖多少？

应该买卖多少是一个基础性的问题，但一般交易者往往会忽视或错误地处理这个问题。

头寸规模对分散化和资金管理策略都有影响。分散化旨在将风险分散到多种不同工具中，同时通过提高成功交易的概率来提高盈利水平。因此，恰当的分散化要求交易者在多种不同工具上投入类似甚至相同的赌注。资金管理实际上就是控制风险，以免过大的风险让你在迎来好趋势之前就被迫出局。

应该买卖多少是交易中最重要的一个问题。新手大多在单笔交易上投注过大，这大大提高了他们的破产风险，即使他们的策略在其他方面是有效的。



### 出入市：什么时候买卖？

有关什么时候买卖的决定被称为出入市决定。自动化的系统会产生出入市信号，明确规定入市时的价格和市场条件，正是这些信号告诉你何时通过买入或卖出而出入市场。



### 止损：什么时候放弃一个亏损的头寸？

长期来看，不能及时止损的交易者不可能获得成功。要想控制损失，最重要的一件事就是在入市之前就确定止损点。



### 退出：什么时候退出一个盈利的头寸？

有许多“交易系统”号称是完整的系统，但实际上并没有明确解决盈利头寸的退出问题。但是，盈利头寸的退出时机对系统的盈利能力来说至关重要。任何不能回答这个问题的系统都不是完整的系统。



### 战术：怎么买卖？

一旦系统产生了交易信号，执行方面的战术技巧就成了重点。对金额比较大的账户来说尤其如此，因为大账户的举动有可能导致价格发生大幅度不利变动，也就是对市场的冲击。

使用机械性的交易系统是保持行动统一的最佳方法。如果你知道你的系统能在长期内赚钱，你就更容易遵守交易信号的指示，在逆境时期也坚持使用你的系统。这里有必要再强调一下：如果你依赖的是自主判断，那么你往往会在应该大胆的时候畏首畏尾，在应该谨慎的时候却莽撞激进。

如果你有一个有效的机械性交易系统，而且能严格地遵守它，系统就会为你盈利，而且能帮助你克服在连续损失或获得巨大利润时的那种不可避免的心理波折。

**海龟们所使用的系统就是一个完整的交易系统，这也是我们获得成功的一大原因。这个系统使我们更容易保持行动的统一，赢面也更大，因为它不会把重要的决定留给交易者的大脑**。



## 2.市场：海龟们的选择

海龟们都是期货交易者。我们在最具影响力的美国期货交易所买卖期货合约。由于我们手中有数百万美元，我们不能选择那种每日成交量只有几百份合约的市场，因为在这样的小市场中，大交易会导致市场剧烈动荡，不承受较大的损失是很难进入或退出的。海龟们只选择流动性最高的市场。事实上，流动性是理查德·丹尼斯为海龟们选择市场的首要标准。

一般来说，海龟们涉足美国所有高流动性市场，除了谷物和肉类市场。由于理查德·丹尼斯本人的账户已经达到了谷物交易头寸的法定上限，他无法再让我们进行谷物交易，否则将超过交易所的头寸限制。我们不碰肉类市场是因为肉类交易厅的场内交易者有腐败问题。海龟班解散若干年后，美国联邦调查局对芝加哥肉类交易厅展开了一次大规模清查行动，以价格操纵和其他形式的腐败罪名起诉了多名交易者。

以下是海龟们进行交易的期货市场：

### 芝加哥期货交易所

- 30年期美国长期国债
- 10年期美国中期国债

### 纽约咖啡、糖与可可交易所

- 咖啡
- 可可
- 食用糖
- 棉花

### 芝加哥商品交易所

- 瑞士法郎
- 德国马克
- 英镑
- 法国法郎
- 日元
- 加拿大元
- 标准普尔500指数·欧元
- 90天美国短期国债

### 纽约商品交易所

- 黄金
- 白银
- 铜

### 纽约商业期货交易所

- 原油
- 民用燃料油
- 无铅汽油

海龟们有权不选择上述任何一种产品，但是，一旦一个海龟排除了某一个市场，他就再也不能进入这个市场。因为我们要保持行动统一。



## 3.头寸规模

海龟们所使用的头寸规模算法在那个时代非常先进，因为它会根据一个市场的绝对波动幅度来调整头寸的规模，等于将头寸的绝对波动幅度标准化了。这意味着，一个特定头寸在某一天向上或向下变动的幅度（以不变美元来衡量）与其他市场上的头寸基本相同，无论这个特定市场的波动性是大还是小。

其中的**原理是：如果一个市场的合约价值波动性较强，那么这个市场中的合约持有量就少一些；相反，如果一个市场的波动性较弱，这个市场中的头寸就可以大一些。总之，市场的波动性与头寸的规模是呈反比的**。

这种波动性标准化处理非常重要，因为这**意味着不同市场上的不同交易在盈亏概率上是相同的：它们都有同样的机会赚一美元或赔一美元。这便提高了多重市场分散化的效果**。

即便某个市场的波动性较弱，一次大趋势也能让海龟们打个大胜仗，因为一种合约的波动性越弱，海龟们手中的合约就越多。

### 波动性：N的含义

海龟们用一个特殊的概念来衡量一个市场的潜在波动性，理查德·丹尼斯和比尔·埃克哈特称之为N。N就是真实波动幅度的20日指数移动平均值，现在更常见的名称是真实波动幅度平均值（Average True Range, ATR）。从理论上说，N代表着一个市场在一天内的平均波动幅度，包括开盘跳空的情况在内。N的单位是点数，也就是这个市场的价格点数。
每一天的真实波动幅度是用下列公式计算的：

真实波动幅度=Max（H-L，H-PDC，PDC-L）

其中：
H=当日最高价
L=当日最低价
PDC=前一日收盘价



AN的计算公式如下：

$N = \frac{19 \times PDN + TR}{20}$￼

其中：
PDN=前一日的N值
TR=当日的真实波动幅度
由于公式中需要前一日的N值，你在首次计算N的时候不能用这个公式，只能计算真实波动幅度的20日简单平均值。

### 美元波动幅度

决定头寸规模的第一个步骤就是计算绝对波动幅度，而绝对波动幅度是根据市场的价格波动性（N值）算出的。
这听起来复杂，实际上很简单。绝对波动幅度的计算公式如下：

绝对波动幅度=N×每一点数所代表的美元

### 波幅调整后的头寸单位

海龟们把头寸分为一个个单位，我们称之为头寸单位。头寸单位的大小要根据市场的波动性进行调整，目的是让一个N相当于账户净值的1%。
因此，一个特定市场或产品的头寸单位规模可以用下列公式算出：



$头寸单位规模 = \frac{账户的1%}{市场的绝对波动幅度}$

$头寸单位规模 = \frac{账户的1%}{N \times 每一点数所代表的美元}$



请看以下例子：

附表1　2003年3月的民用燃料油合约价格、真实波动幅度和N值

| 日期           | 最高价 | 最低价 | 收盘价 | 真实波动幅度 | N值    |
| -------------- | ------ | ------ | ------ | ------------ | ------ |
| 2002年11月1日  | 0.7220 | 0.7124 | 0.7124 | 0.0096       | 0.0134 |
| 2002年11月4日  | 0.7170 | 0.7073 | 0.7073 | 0.0087       | 0.0132 |
| 2002年11月5日  | 0.7099 | 0.6923 | 0.6923 | 0.0176       | 0.0134 |
| 2002年11月6日  | 0.6930 | 0.6800 | 0.6838 | 0.0130       | 0.0134 |
| 2002年11月7日  | 0.6960 | 0.6736 | 0.6736 | 0.0224       | 0.0139 |
| 2002年11月8日  | 0.6820 | 0.6706 | 0.6706 | 0.0114       | 0.0137 |
| 2002年11月11日 | 0.6820 | 0.6710 | 0.6710 | 0.0114       | 0.0136 |
| 2002年11月12日 | 0.6795 | 0.6720 | 0.6744 | 0.0085       | 0.0134 |
| 2002年11月13日 | 0.6760 | 0.6550 | 0.6616 | 0.0210       | 0.0138 |
| 2002年11月14日 | 0.6650 | 0.6585 | 0.6627 | 0.0065       | 0.0134 |
| 2002年11月15日 | 0.6701 | 0.6220 | 0.6701 | 0.0081       | 0.0131 |
| 2002年11月18日 | 0.6965 | 0.6750 | 0.6965 | 0.0264       | 0.0138 |
| 2002年11月19日 | 0.7065 | 0.6944 | 0.6944 | 0.0121       | 0.0137 |
| 2002年11月20日 | 0.7115 | 0.6944 | 0.7087 | 0.0171       | 0.0139 |
| 2002年11月21日 | 0.7168 | 0.7100 | 0.7124 | 0.0081       | 0.0136 |
| 2002年11月22日 | 0.7265 | 0.7120 | 0.7265 | 0.0145       | 0.0136 |
| 2002年11月25日 | 0.7265 | 0.7098 | 0.7098 | 0.0167       | 0.0138 |
| 2002年11月26日 | 0.7184 | 0.7110 | 0.7184 | 0.0086       | 0.0135 |
| 2002年11月27日 | 0.7280 | 0.7200 | 0.7228 | 0.0096       | 0.0133 |
| 2002年12月2日  | 0.7375 | 0.7227 | 0.7359 | 0.0148       | 0.0134 |
| 2002年12月3日  | 0.7447 | 0.7310 | 0.7389 | 0.0137       | 0.0134 |
| 2002年12月4日  | 0.7420 | 0.7140 | 0.7162 | 0.0280       | 0.0141 |





根据2002年12月4日的N值0.0141，12月6日的头寸单位规模计算如下：
N=0.0141
账户规模=1000000美元
每一点数所代表的美元=42000（每份合约代表42000加仑民用燃料油，以美元报价）



$头寸单位规模 = \frac{0.001 \times 1000000}{0.0141 \times 42000} = 16.89$



由于期货合约是不能拆分的，我们舍去小数，得出16份合约的结果。

你可能会问：“你们多长时间算一次N值和头寸单位规模？”实际上，海龟们每个星期一都能拿到一张头寸单位规模表，上面列出了我们所交易的每一份合约的N值和头寸单位规模。

### 头寸规模的重要性

前面说过，分散化旨在将风险分散到多种不同工具上，同时通过提高成功交易的概率来提高盈利水平。恰当的分散化要求交易者在多种不同工具上投入类似甚至相同的赌注。

海龟交易系统用市场波动性来衡量每一个市场的风险水平。然后，我们会根据这个风险准绳来逐步建立与风险量（或波幅）相匹配的头寸。这增强了分散化的效果，提高了盈利交易弥补亏损交易的概率。

请注意，如果你没有足够的资金，这样的分散化是很难实现的。在上面的例子中，假如账户的规模不是100万美元，而是10万美元，那么头寸单位的规模将是1份合约，因为1.689舍去小数就是1。**对这种小账户来说，调整的精确性太低，这会大大降低分散化的效果。**

### 风险与头寸单位

由于海龟们用头寸单位来衡量头寸的大小，而这样的头寸单位要根据波动性风险进行调整，头寸单位实际上就成了单个头寸和整个头寸组合的一个风险衡量指标。

海龟资金管理法则在4个不同层面上限制了我们的交易量。从本质上说，这些法则控制了交易者的总体风险水平。无论是在没完没了的亏损时期还是在翻天覆地的价格动荡中，这些限制都能把损失最小化。

1987年10月股市崩溃之后的那一天就是一个惊天大动荡的例子。为了唤起人们对股市和美国经济的信心，美联储在一夜之间决定降息几个百分点。海龟们已经大举抛空利率类合约，比如欧洲美元、短期国债和长期国债，因此第二天的损失大得可怕。大多数海龟的账户净值都在一天内损失了40%~60%。但是，如果没有最大头寸的限制，我们的损失就要比这个数字大得多。

这4个层面的限制如下：



附表2　4个层面的限制

| 层面 | 限制范围               | 头寸单位上限 |
| ---- | ---------------------- | ------------ |
| 1    | 单个市场               | 4            |
| 2    | 高度关联的多个市场     | 6            |
| 3    | 松散关联的多个市场     | 10           |
| 4    | 单个方向（多头或空头） | 12           |

￼
单个市场：每个市场中的头寸单位不得超过4个。

高度关联的多个市场：在紧密关联的市场中，我们在某一个方向上的头寸单位不得超过6个（也就是说，空头单位最多6个，多头单位也最多6个）。高度关联的市场组合包括：民用燃料油与原油、黄金和白银、所有外汇，以及像短期国债和欧洲美元这样的利率类期货等。

松散关联的多个市场：对松散关联的市场来说，我们在某一个方向上的头寸单位不得超过10个。松散关联的市场包括黄金与铜、白银与铜，以及海龟们因为法定头寸限制而无法交易的许多谷类组合。

单个方向（多头或空头）：任何一个方向上的总头寸单位都不得超过12个。因此，一个海龟从理论上说可以同时持有12个空头单位和12个多头单位。

海龟们用“满仓”这个词来表示他们已经达到了某个层面的头寸规模上限。因此，日元满仓是指已经持有4个单位的日元合约，完全满仓是指某个方向上的头寸单位已经达到12个，诸如此类。

### 调整交易规模

有时候，市场会连续许多个月没有趋势出现。在这种情况下，你的账户净值有可能遭受巨大的损失。

而在一次次大捷之后，你可能想扩大账户规模，进而扩大头寸规模。

海龟们的账户并不是那种在初始净值的基础上逐笔结算的普通账户。我们拿到的是名义账户，规模是指定的，初始净值为零。例如，当我们在1983年2月刚刚开始实战时，许多海龟拿到的是一个100万美元的名义账户。账户规模每年年初调整一次。上调还是下调要看里奇对交易者的评价。调整幅度一般与这个账户上一年度的盈亏状况紧密相关。

每当我们损失了初始账户金额的10%时，里奇都会把我们的账户规模缩减20%。这样，如果我们的100万美元初始账户金额损失了10%，也就是10万美元，我们的账户金额将会下调到80万美元，直到账户净值恢复到年初的水平。如果我们又一次损失了10%（80万美元的10%，也就是8万美元，这样总损失达到了18万美元），我们就得把账户金额再压缩20%，这样账户金额就只剩下64万美元。

根据盈亏状况调整账户金额可能还有更好的方法。以上只是海龟们的方法。



## 4.入市策略

交易者大多从入市信号的角度来评判一个特定的交易系统。他们相信，入市策略对一个交易系统来说是最重要的环节。
所以他们可能想不到，海龟们使用的是一个以唐奇安趋势系统为基础的非常简单的入市系统。

海龟们使用两个有所差异但也彼此相关的入市系统，我们称为系统1和系统2。我们可以自由决定如何在这两个系统之间分配资金。有的海龟只用系统2，有的在两个系统上各投入50%的资金，还有的采用其他组合形式。这两个系统分别是：

**系统1：以20日突破为基础的短期系统**

**系统2：以55日突破为基础的长期系统**



### 突破

突破是指价格超越过去一定时期内的最高点或最低点。所以，20日突破就是指价格超越过去20天内的最高点或最低点。

海龟们总是在突破发生时立即入市交易，不会等当日收盘或次日开盘。在跳空开盘的情况下，假如开盘价已经跳过了突破价，海龟们就在开盘时入市。



### 系统1入市法则

只要价格突破20日最高或最低点一个最小单位，海龟们就马上行动。如果价格超越20日最高点，海龟们就买入1个头寸单位，开始做多；如果价格跌破20日最低点，海龟们就卖出1个头寸单位，开始做空。

但是，假如上一次突破是一次盈利型突破（也就是可以带来一次盈利的交易），那么系统1的当前入市信号将被忽略。注意：对这一法则来说，上一次突破就是指市场的上一次实际突破，而不管交易者当时是采取了突破交易还是根据这一法则忽略了那次突破。那么什么是亏损型突破呢？如果突破日之后的价格在头寸有机会退出获利（根据10日突破退出法则）之前发生了2N幅度的不利变动，这就被视为一次亏损型突破。

对这一法则来说，上一次突破的方向并不重要。因此，无论上一次突破是向上突破还是向下突破，只要是亏损型突破，目前的新突破（无论是向上还是向下突破）就会被视为有效的入市信号。

不过，如果一次突破因为这条法则而被忽略，那么交易者将在55日突破点入市，这是为了避免错过重大趋势。这个55日突破点被视为一个保障性突破点。

在任何时候，如果一个交易者处于离场等待的状态，那么总有某个价位能引发空头入市信号，也总有某个更高的价位能引发多头入市信号。如果上一次突破是亏损型的，那么新突破点（也就是20日突破点）将更接近当前价格；如果上一次突破是盈利型的，那么新突破点可能离当前价格远得多，因为那有可能是个55日突破点。



### 系统2入市法则

只要价格突破55日最高或最低点一个最小单位，我们就入市。如果价格超越55日最高点，海龟们就买入1个头寸单位，开始做多；如果价格跌破55日最低点，海龟们就卖出1个头寸单位，开始做空。

对系统2来说，所有突破都被视为有效信号，无论上一次突破是亏损型的还是盈利型的。



### 逐步建仓

海龟们首先在突破点建立1个单位的头寸，然后按 N/2 的价格间隔一步步扩大头寸。这个N/2的间隔以上一份定单的实际成交价格为基础。所以，如果最初的突破交易发生了N/2的成交价偏差，那么新定单的价格将与突破点相差1N，也就是最初N/2的偏差加上N/2的标准间隔。

这个过程将继续下去，一直到头寸规模达到上限。如果市场足够活跃，我们有可能在一天内加满4个头寸单位。

请看下面的例子：

**黄金**

N=2.50
55日突破价=310.00
第一个单位：310.00
第二个单位：310.00 + 1/2 × 2.5 = 311.25
第三个单位：311.25 + 1/2 × 2.5 = 312.50
第四个单位：312.50 + 1/2 × 2.5 = 313.75



**原油**

N=1.20
55日突破价=28.30
第一个单位：28.30
第二个单位：28.30+1/2×1.20=28.90
第三个单位：28.90+1/2×1.20=29.50
第四个单位：29.50+1/2×1.20=30.10



### 统一性

里奇要求海龟们坚定不移地遵守入市信号，因为一整年的大部分利润很有可能就来自两三次大的盈利交易。哪怕你只忽略或错过了一个信号，这一年的回报率也可能大打折扣。

表现最好的海龟都是入市法则的坚定信徒。表现最差的海龟和那些被淘汰出局的人都不能始终如一地坚持执行法则。





## 5.止损

交易行业里有这么一句话：“有老交易者，也有不怕死的交易者，但是没有不怕死的老交易者。”不设置止损点的交易者十有八九会破产。海龟们一定会设置止损点。

面对一个亏损的头寸，你可以坚守阵地，寄希望于失而复得，也可以割肉退出，承认这次交易不成功。对大多数人来说，前者远比后者要容易。

我可以明明白白地告诉你：执行系统法则的命令，退出亏损的头寸是一个生死攸关的要点。不懂甩掉损失的交易者很长时间都不会成功。包括巴林银行和长期资本管理公司的灾难在内，几乎所有失去控制的致命交易行为都与不能防微杜渐、及时控制损失有关。

要控制损失，最重要的一件事就是在入市之前确定退出的标准。一旦价格到达了你的止损点，你必须退出——坚定不移、无一例外。犹豫和动摇终将酿成灾难。

注意：读者也许会注意到，这里的观点与我在第十章的说法有所不同。在第十章，我曾说加入止损点有时候对系统不利，因此并不一定有必要。但是，之前所说的那些表现良好的系统看似没有止损点，实际上却有一种内在的止损机制，因为当价格向不利的方向持续变化时，移动平均线早晚会交叉，损失水平终会受到限制。因此从某种意义上说，系统中有一个止损点，只不过交易者看不到它或不知道它罢了。不过，对大多数交易者来说，有一个明确的止损退出点可以在心理上更容易接受。对新手来说尤其如此。目睹头寸日益萎缩却一眼看不到苦日子的尽头，这对交易者来说是一种心理上的折磨。

### 海龟止损点

海龟们会使用止损点，但这并不意味着我们真的会向经纪人下止损单。

由于海龟们手中的头寸规模非常庞大，我们不愿意下止损单，因为这有可能暴露我们的头寸状况或交易策略。我们会事先确定一个特定的止损价位，当市场达到这个价位时，我们将通过限价定单或市价定单来退出我们的头寸。
这些止损价位就是雷打不动的退出点。只要市场到达止损价位，我们就毫不迟疑地坚决退出。

### 止损点

海龟们根据头寸风险来设定止损点。任何一笔交易的风险程度都不得超过2%。

由于1N的价格变动代表着账户净值的1%，在2%的风险限制下，价格变动的上限就是2N。海龟们的止损点就是2N：对多头头寸来说，止损价比入市价低2N；对空头头寸来说，止损价比入市价高2N。

为了把整体头寸风险控制在最低水平，如果我们（按N/2的价格间隔）后续补充了头寸单位，那么之前头寸单位的止损点将相应地调整N/2。一般来说，这意味着整个头寸的止损点将与最新添加的头寸单位相距2N的距离。不过，如果头寸补充的价格间隔因为市场变化过快或开盘跳空等情况而大于N/2，那么止损点也会有所变化。

下面是一个例子：

**原油**
N=1.20
55日突破价=28.30

|            | 入市价     | 止损价     |
| ---------- | ---------- | ---------- |
| 第一个单位 | 28.30      | 25.90      |
|            | **入市价** | **止损价** |
| 第一个单位 | 28.30      | 26.50      |
| 第二个单位 | 28.90      | 26.50      |
|            | **入市价** | **止损价** |
| 第一个单位 | 28.30      | 27.10      |
| 第二个单位 | 28.90      | 27.10      |
| 第三个单位 | 29.50      | 27.10      |
|            | **入市价** | **止损价** |
| 第一个单位 | 28.30      | 27.70      |
| 第二个单位 | 28.90      | 27.70      |
| 第三个单位 | 29.50      | 27.70      |
| 第四个单位 | 30.10      | 27.70      |

￼
￼
假如第四个单位因为市场跳空高开在每股30.80美元成交，那么结果将变为：

|            | 入市价 | 止损价 |
| ---------- | ------ | ------ |
| 第一个单位 | 28.30  | 27.70  |
| 第二个单位 | 28.90  | 27.70  |
| 第三个单位 | 29.50  | 27.70  |
| 第四个单位 | 30.80  | 28.40  |

￼

### 备选止损策略：双重损失

海龟们也学习了另外一种叫作双重损失的止损策略。这种策略可以实现更高的利润率，但更难执行，因为它所造成的损失要比一般策略多得多，胜负比率会大大降低。

在双重损失策略下，每一笔交易的风险上限不是2%，而是0.5%。也就是说，价格波动的上限是1/2N。在一个头寸单位止损退出后，交易者将在价格恢复到最初的入市价时重新建立这个单位。有几个海龟很成功地运用了这种策略。

双重损失策略还有一个好处：它不需要随着新头寸单位的补充而调整之前单位的止损点，因为我们最多只能有4个单位，总风险水平不可能超过2%。

比如，如果采用双重损失策略，那么上述原油交易将变成下面的样子：

**原油**
N=1.20
55日突破价=28.30



|            | 入市价     | 止损价     |
| ---------- | ---------- | ---------- |
| 第一个单位 | 28.30      | 27.970     |
|            | **入市价** | **止损价** |
| 第一个单位 | 28.30      | 27.70      |
| 第二个单位 | 28.90      | 28.30      |
|            | **入市价** | **止损价** |
| 第一个单位 | 28.30      | 27.70      |
| 第二个单位 | 28.90      | 28.30      |
| 第三个单位 | 29.50      | 28.90      |
|            | **入市价** | **止损价** |
| 第一个单位 | 28.30      | 27.70      |
| 第二个单位 | 28.90      | 28.30      |
| 第三个单位 | 29.50      | 28.90      |
| 第四个单位 | 30.10      | 29.50      |





### 海龟止损策略的优势

由于海龟止损点以N为基础，它们与市场的波动性息息相关。更具波动性的市场有更大的止损范围，但每个头寸单位的合约数量也相对较少。这便统一了所有交易的风险水平，加强了分散化的效果和风险管理的稳健性。



## 6.退出

交易行业里还有一句老话：“落袋为安的人永远也不会破产。”但海龟们不会同意这种论调。趋势跟踪者最常犯的错误之一就是过早地退出盈利的头寸，也就是过早地“落袋为安”。

价格永远也不会直上直下，没有波动。因此，要想抓住一次趋势，你必须允许价格偶尔向不利的方向变动。在趋势的初期，这往往意味着10%\~30%的利润在你眼前化为乌有；在趋势的中期，你或许会眼睁睁地看着80%~100%的利润跌去三四成。在这些情况下，放掉包袱、“锁定利润”的诱惑是很强大的。

海龟们知道，盈利的时机足以决定你的成败。

**海龟系统在突破点入市，但大多数突破点都不会引发趋势。这意味着海龟们的大多数交易都是亏损的。如果少数盈利的交易赚不到足够多的钱来弥补这些损失，海龟们就会是输家。每一个有效的交易系统都有自己的最佳退出点。**

考虑一下海龟交易系统：如果你总是在1N的利润水平下退出盈利的交易，却在2N的止损点退出亏损的交易，那么你的盈利次数必须是亏损次数的两倍才能做到盈亏平衡。

交易系统的各个组成部分之间有着复杂的关系。因此，如果你不考虑入市点、资金管理和其他因素，你就没法考虑正确的退出策略。

盈利头寸的退出策略是最重要的问题之一，但也是最不受重视的问题之一。然而，它完全可以决定一笔交易的成败。

### 海龟退出策略

系统1采用10日突破退出法则：对多头头寸来说，在价格跌破10日最低点时退出；对空头头寸来说，在价格超过10日最高点时退出。总之，如果价格发生了不利于头寸的10日突破，所有头寸单位都要退出。

系统2则采用20日突破退出法则：对多头头寸来说，在价格跌破20日最低点时退出；对空头头寸来说，在价格超过20日最高点时退出。只要价格发生了不利于头寸的20日突破，所有头寸单位就都要退出。

就像入市策略一样，海龟们一般不会通过止损单退出，而是会紧密观察市场的动向，在价格达到退出突破点时马上下单退出。

### 退出不易

对大多数交易者来说，退出策略可能是整个海龟交易系统中最难忍受的环节。你必须等待市场创下10日或20日新低时才能退出，这往往意味着目睹20%、40%甚至100%的巨额利润瞬间蒸发。

所以，交易者总有一种提早退出的强烈冲动。你需要极强的纪律性才能坚守阵地，忍受利润的蒸发，直到抓住真正的大趋势。在大的盈利交易中遵守纪律和法则就是经验丰富的成功交易者的标志。

### 战术

著名建筑师密斯·凡德罗在谈到建筑设计时曾说过这样一句话：“细节就是上帝。”对交易系统来说同样如此。在使用海龟交易法则的过程中，有些重要的细节对你的盈利水平有举足轻重的影响。

### 下单

前面说过，**理查德·丹尼斯和比尔·埃克哈特建议海龟们不要使用止损单，而是应该随时观察市场动向，在价格到达止损点的时候再行动**。他们还告诉我们，**限价定单总的来说要强于市价定单。比起市价定单，限价定单更容易以更有利的价格成交，成交价偏差也要小一些。**

任何时候的任何市场都有买入价和卖出价这两个报价。买入价就是买家们愿意接受的买价，卖出价就是卖家们愿意接受的卖价。只要买入价超过卖出价，交易就会发生。如果市场的成交量足够大，市价定单就总能在买入价或卖出价成交，不过大定单的成交价有时候也会有一些偏差。

一般来说，市场总会发生一定幅度的相对随机性波动，这有时候被称为反弹。之所以使用限价定单，就是为了把价格定在反弹区域的底端，而不是简简单单地接受当前的市价。一个小的限价定单不会触动市场，即使定单较大，它对市场的触动也小于市价定单。

确定限价定单的最佳定价是需要一定技巧的。不过，只要多做练习，你完全能学会用接近市价的限价定单获得比市价定单更好的成交价。

### 急变市场

有时候，市场变化速度太快，顷刻之间就会跳过你的定单价。如果你用的是限价定单，你根本没机会成交。在这类急变市场中，每份合约的价值可能在短短几分钟之内涨跌数千美元之多。

在这种情况下，海龟们的原则是保持冷静，等市场稳定下来再做打算。但大多数新手都很难做到这一点。他们会惊慌失措，手忙脚乱地发出市价定单。他们十有八九是在最差的时机下单的，到头来，他们的成交价是一天内最差的价格，不是最高点就是最低点。

在一个急变市场中，流动性会暂时固定。如果市场露出急变的迹象，卖家会停手观望，等待价格继续上涨，而且在飙升趋势停止之前不会再卖。这样一来，卖出价会急剧上升，而且买卖价差会有所扩大。

随着卖家不断抬高要价，买家也被迫抬高出价，于是价格上涨越来越快，最终引来更多的卖家。随着卖家越来越多，价格会平稳下来，往往还会快速逆转，大幅回调。

到头来，市价定单的成交点通常就是上行趋势的最高点，也就是市场开始停止上涨，趋于稳定的时候。

**在这类情况下，海龟们会一直等到市场出现逆转迹象（至少是暂时逆转）的时候再行动，这时候的成交价通常要比市价定单的成交价好得多。如果市场趋于稳定后的价格已经超过我们最初的止损价，我们会退出市场，但不会惊慌失措。**

### 同步入市信号

在很多时候，市场非常平稳、波澜不惊，所以海龟们除了监控手头的头寸之外基本上无事可做，有可能在很长一段时间没有任何动作。有的时候也会有点儿忙碌，几个小时内陆陆续续地出现多个信号，我们会按部就班地行动，直到达到相应市场的头寸上限。

但也有的时候，似乎所有事情都在同一时间发生，我们个个忙得昏天黑地，在一两天之内就从两手空空变成了满仓。而且相互关联的市场常常会同时发出信号，令疯狂的节奏变得更加疯狂。

如果各个市场一开盘就跳空越过了入市信号，那就更不用说了。你可能在同一天内看到原油、民用燃料油和无铅汽油市场的跳空开盘入市信号。对期货合约来说，**同一个市场的多个不同月份的合约同时出现信号也是很常见的事**。在这种情况下，你必须高效、快速地行动，而且不能惊慌，不能乱下市价定单，否则你的交易质量必然会大打折扣。

### 买强卖弱

**如果多个信号在同一时间出现，我们会在同一类市场中选择最强势的市场买入，选择最弱势的市场卖空。**

另外，我们在同一时间只会选择一个月的合约，而且只会建立一个头寸单位。比如，我们不会同时买入2月、3月和4月的民用燃料油合约，而是会选择最强势而且有足够高成交量和流动性的合约。

这一点极其重要。在同一类相互关联的市场中，最好的多头交易都存在于最强势的市场中（这些市场的表现几乎必然强于较弱的同类市场）。同样，最好的空头交易都存在于最弱势的市场中。

海龟们用多种不同的衡量标准来判断市场的强弱。最简单也最常用的一种方法就是看图表，根据视觉判断来选出“看起来”更强（或更弱）的市场。

有些海龟的衡量标准是N：他们会比较各个市场自发生突破之后已经变化了多少个N，然后在变化幅度最大（以N来衡量）的市场中买入。还有一些海龟把不同市场的变化标准化了：他们用当前价格减去3个月之前的价格，然后再除以N。值最高的就是最强的市场，值最低的就是最弱的市场。

这些方法都很有效。总而言之，要点在于在最强的市场上做多，在最弱的市场上做空。

### 合约滚动

当一期合约到期时，你在转向后期新合约之前需要注意两个因素。

首先，**在很多时候，近期的合约虽然有很好的趋势，但较远期的合约并没有表现出同样的势头。除非新合约的趋势同样符合你的要求，否则不要向新合约滚动。**

其次，你必须赶在现有合约的成交量和未平仓量大幅萎缩之前滚向新合约。什么叫“大幅萎缩”？这要看头寸单位有多大。一般来说，海龟们会在合约到期之前几个星期将现有头寸滚向后期新合约，除非现有合约的表现远好于后期的新合约。



## 7.结束语

以上就是海龟交易系统的全套法则。你可能会觉得它们并没有多么复杂。

但是，单单知道这些法则是没有用的，你必须有遵守这些法则的能力。

想想理查德·丹尼斯的话：“我说过很多次，你可以把我们的交易法则登在报纸上，但没人会遵守它们。关键是统一性和纪律性。几乎每个人都可以列出一串法则，而且不比我们的那些法则差多少，但不是每个人都能给别人信心。唯有对法则充满信心，你才会坚持它们，即使在遭遇逆境时也是一样。”

海龟们的表现也许就是对这段话的最好诠释：有许多海龟并没有赚钱。这不是因为海龟交易法则无效，而是因为他们不能也没有遵守这些法则。

**海龟法则是很难坚持的，因为它们以捕捉相对罕见的大趋势为基础。**正因为大趋势难得一见，所以你在迎来盈利期之前可能要等上好多个月，有时候甚至是一两年。在漫长的等待中，你很容易对海龟系统产生怀疑，忍无可忍地放弃这个系统。你会想：如果这些法则不再有效了怎么办？如果市场已经变了怎么办？如果这些法则有重要的疏漏怎么办？我怎么知道这个系统一定有效？

有个不到一年就被淘汰的首期海龟班成员一开始就怀疑里奇有意对全班成员隐瞒某些信息，最终，他开始相信里奇有一些不会透露的秘诀。这个海龟不敢勇敢地面对一个简单的事实：他的糟糕表现完全是他的疑心和没有安全感造成的，正是这些心理因素导致他无法遵守我们的法则。

改变法则的冲动也是一个问题。有很多海龟对我们的法则做了一些轻微的调整，说是为了降低交易的风险，但效果往往适得其反。下面就是一个例子。

有时候，交易者建立头寸不像法则规定的那样快（每隔1/2N建立一个单位）。这听起来似乎是一种更为保守的方法，但实际上并非如此。对海龟们所使用的入市系统来说，如果头寸补充较慢，市场的回调就更容易触及止损退出点，造成意外损失。**而快速行动可以让你的头寸安然度过市场回调，避免触发止损机制。在特定市场状况下，这种微小的变化足以对系统的利润率产生重大的影响。**

要想坚持一个交易系统的法则，建立对系统的信心是非常重要的。无论是海龟系统，与其类似的系统还是其他完全不同的系统，你必须亲自用历史交易数据检验你的系统。别人说一个系统有效是没用的，其他人的研究结果也不代表什么。你必须自己完成这个任务。

用点儿心思，亲力亲为。研究一下交易记录，看看每日净值报告，把系统的交易方式、损失的程度和频率背得滚瓜烂熟。

**如果你知道过去的20年中曾有过很多旷日持久的亏损期，你就更容易忍受一个历时8个月的亏损期。如果你知道快速补充头寸是系统盈利的一个关键环节，你就更容易遵守法则、快速行动。**
