# 计算机网络体系结构第二次作业

作业要求：

> 1. 推导杜邦分析公式：ROE = 净利润率 x 总资产周转率 x 权益乘数，并简要分析宏观经济放缓对于 ROE 的影响。
> 2. 因为假的东西难以长久，看财报最好多看几年。1）利用 akshare 库获取上市公司的财务报表数据（代码参考附录 1），计算每只股票在 2021 年至 2023 年期间的 ROE（由于 akshare 没有给出归母净利润，这里假设净利润 = 归母净利润）。2）希望对同一板块的公司进行 ROE 的横向比较。
> 3. 在 2 的基础上，针对于 ROE 最高的公司，根据其某一年，如 2023 年的年度报表，进行杜邦分析。（markdown 画图可参考附录 2）

## 理论推导

### 杜邦分析公式

杜邦分析公式是一个用于分解公司 ROE 的公式，它将 ROE 分解为三个部分：净利润率、总资产周转率和权益乘数。具体推导如下：

$$
\begin{alignat*}{3}
    \text{净利润率}    & \coloneqq \frac{\text{归母净利润}}{\text{营业收入}} \tag{净利润率} \\
    \text{总资产周转率} & \coloneqq \frac{\text{营业收入}}{\text{平均总资产}} \tag{总资产周转率} \\
    \text{权益乘数}    & \coloneqq \frac{1}{1 - 资产负债率} \tag{权益乘数} \\
                      & = \frac{1}{1 - \frac{平均总负债}{平均总资产}} \\
                      & = \frac{平均总资产}{平均总资产 - 平均总负债} \\
                      & = \frac{\text{平均总资产}}{\text{净资产}} \\
    ROE               & \coloneqq \frac{\text{归母净利润}}{\text{净资产}} \tag{净资产收益率} \\
                      & = \frac{\text{归母净利润}}{\text{营业收入}} \times \frac{\text{营业收入}}{\text{净资产}} \\
                      & = \frac{\text{归母净利润}}{\text{营业收入}} \times \frac{\text{营业收入}}{\text{平均总资产}} \times \frac{\text{平均总资产}}{\text{净资产}} \\
                      & = \text{净利润率} \times \text{总资产周转率} \times \text{权益乘数}
\end{alignat*}
$$

## 实验设置

- 分析时间区间（可以通过修改 DATES 变量进行自由配置）：
  - 2021 年至 2023 年。（主要区间）
  - 2019 年至 2023 年。
  - 2014 年至 2023 年。
  - 2009 年至 2023 年。
- 分析股票范围：在区间中的每年均发布了年度报表、且净资产均为正的股票。
- 分析板块范围：所有概念板块和所有行业板块，重点分析包含股票数量最多的十个板块。
- 主要分析指标：ROE。

### 杜邦分析设置

杜邦分析中呈现的数据：

- 净资产收益率（ROE）
- 总资产周转率
- 资产负债表
  - 权益乘数
  - 资产负债率
  - 净资产（股东权益合计）
  - 总资产
    - 流动资产
      - 货币资金
      - 交易性金融资产
      - 应收账款
      - 存货
      - 结算备付金
      - 应收保费
    - 非流动资产
      - 可供出售金融资产
      - 固定资产
  - 总负债
    - 流动负债
      - 应付账款
      - 预收账款
      - 向中央银行借款
      - 代理买卖证券款
      - 卖出回购金融资产款
      - 拆入资金
      - 短期借款
      - 预收保费
    - 非流动负债
      - 吸收存款
      - 发放贷款及垫款
  - 所有者权益
    - 股东权益合计
- 利润表
  - 归母净利润
  - 利润总额
  - 总资产收益率
  - 营业净利润率
  - 营业总收入
    - 营业收入
    - 利息净收入
    - 手续费及佣金净收入
    - 已赚保费收入
    - 投资收入
  - 营业总支出
    - 营业支出
    - 销售支出
    - 管理支出
    - 财务支出
    - 收入税支出
    - 营业税金及附加费支出
    - 退保金额支出
    - 赔付支出

## 实验原理、实现、结果与分析

- 通过 akshare 库获取上市公司的财务报表数据包括东方财富的资产负债表、利润表、现金流量表等三大报表和业务报表。
- 借助 pandas 库计算不同时间区间内各股票的 ROE 等指标，并对同一板块的股票进行 ROE 的横向比较。
- 对不同时间区间内 ROE 最高的几个公司，根据其年度报表和之前计算的指标进行杜邦分析。

### 获取数据

- akshare 在处理数据时丢弃了一些列，所以得到的数据相比东方财富提供的完整信息有一定欠缺。此处对 akshare 1.13.16 库相关函数的实现稍作更改，获取到财务报表中的更多数据，以进行更详细的杜邦分析。
- 分年份对年度报表进行下载和缓存。
- 读取财务数据，并查看报表中可以使用的信息。
- 查看资产负债率概况。
- 查看年度净利润概况。
- 收集在指定年份都处于上市状态且发布了年度财报的股票。

### 计算指标

- 对每只股票每年的以下指标进行求和：
  - 归母净利润
  - 扣减归母净利润
  - 营业总收入
    - 营业收入
    - 利息净收入
    - 手续费及佣金净收入
    - 已赚保费
    - 投资收入
  - 营业总支出
    - 营业支出
    - 销售支出
    - 管理支出
    - 财务支出
    - 收入税费
    - 营业税金及附加费
    - 退保金额
    - 赔付支出
  - 营业利润
  - 利润总额
- 对每只股票的以下指标求平均值：
  - 总资产
  - 流动资产
    - 货币资金
    <!-- - 交易性金融资产 -->
    - 应收账款
    - 存货
    - 结算备付金
    - 应收保费
  - 非流动资产
    - 可供出售金融资产
    - 固定资产
  - 总负债
    - 流动负债
      - 应付账款
      - 预收账款
      - 向中央银行借款
      - 代理买卖证券款
      - 卖出回购金融资产款
      - 拆入资金
      - 短期借款
      - 预收保费
    - 非流动负债
      - 吸收存款
      - 发放贷款及垫款
  - 股东权益合计
- 通过以下公式计算指标：
  - 营业净利润 = 营业总收入 - 营业总支出
  - 营业净利润率 = 营业净利润 / 营业总收入
  - 总资产周转率 = 营业总收入 / 总资产
  - 资产负债率 = 总负债 / 总资产
  - 净资产 = 股东权益合计 = 总资产 - 总负债
  - 权益乘数 = 总资产 / 净资产
  - ROE = 归母净利润 / 净资产 <!-- = 营业净利润率 * 总资产周转率 * 权益乘数 -->
- 去除净资产为负的股票
- 查看计算结果的概况
  - 查看营业净利润率的概况
  - 查看总资产周转率的概况
  - 查看权益乘数的概况
  - 查看 ROE 的概况
- 对 ROE 进行排序，选取 ROE 最高的几只股票进行杜邦分析
